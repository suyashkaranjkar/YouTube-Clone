(function(g){var window=this;'use strict';var qYW=function(M){var f=new g.S2("und",new g.q6("Default","und",!0));f.captionTracks=M.captionTracks;return f},HSR=function(M){return new g.g1(function(f,A){var Q=M.length,N=[];
if(Q)for(var Y=function(t,v){Q--;N[t]=v;Q==0&&f(N)},I=function(t){A(t)},D,E=0;E<M.length;E++)D=M[E],g.lxt(D,g.Dv(Y,E),I);
else f(N)})},jm=function(M){this.K=M},$N=function(){jm.apply(this,arguments)},mW9=function(){$N.apply(this,arguments)},sSB=function(){$N.apply(this,arguments)},cpm=function(){$N.apply(this,arguments)},R9m=function(){$N.apply(this,arguments)},gQB=function(){$N.apply(this,arguments)},BEC=function(){$N.apply(this,arguments)},iSB=function(){jm.apply(this,arguments)},xWm=function(){$N.apply(this,arguments)},ZSC=function(){$N.apply(this,arguments)},rpm=function(){$N.apply(this,arguments)},uJ7=function(){$N.apply(this,
arguments)},z90=function(){$N.apply(this,arguments)},PZ0=function(){$N.apply(this,arguments)},nQB=function(){$N.apply(this,arguments)},jSK=function(){$N.apply(this,arguments)},$Wv=function(){$N.apply(this,arguments)},Fuc=function(){$N.apply(this,arguments)},ypC=function(){$N.apply(this,arguments)},dWc=function(){$N.apply(this,arguments)},e9m=function(){jm.apply(this,arguments)},bSW=function(){$N.apply(this,arguments)},kH7=function(){$N.apply(this,arguments)},WuK=function(){$N.apply(this,arguments)},
OSB=function(){$N.apply(this,arguments)},Xg0=function(){$N.apply(this,arguments)},Jpw=function(){$N.apply(this,arguments)},Ku9=function(){$N.apply(this,arguments)},GHm=function(){$N.apply(this,arguments)},wgc=function(){$N.apply(this,arguments)},lke=function(){jm.apply(this,arguments)},MRm=function(){jm.apply(this,arguments)},fXe=function(){jm.apply(this,arguments)},Ajc=function(){$N.apply(this,arguments)},Q57=function(){$N.apply(this,arguments)},NiW=function(){$N.apply(this,arguments)},YSC=function(){$N.apply(this,
arguments)},IXv=function(){$N.apply(this,arguments)},Tie=function(){$N.apply(this,arguments)},D2K=function(){$N.apply(this,arguments)},EEK=function(){$N.apply(this,arguments)},tRC=function(){$N.apply(this,arguments)},vE0=function(){$N.apply(this,arguments)},pRm=function(){$N.apply(this,arguments)},hlB=function(){$N.apply(this,arguments)},SS0=function(){$N.apply(this,arguments)},LbB=function(){$N.apply(this,arguments)},oEB=function(){$N.apply(this,arguments)},CEc=function(){$N.apply(this,arguments)},
U2m=function(){$N.apply(this,arguments)},VR9=function(){$N.apply(this,arguments)},aXR=function(){$N.apply(this,arguments)},qSB=function(){$N.apply(this,arguments)},H27=function(){$N.apply(this,arguments)},m2m=function(){$N.apply(this,arguments)},s5w=function(){$N.apply(this,arguments)},cj6=function(){$N.apply(this,arguments)},RlB=function(){$N.apply(this,arguments)},gEB=function(){$N.apply(this,arguments)},Bi7=function(){jm.apply(this,arguments)},i20=function(){$N.apply(this,arguments)},x2B=function(){$N.apply(this,
arguments)},Z2B=function(){$N.apply(this,arguments)},rj9=function(){$N.apply(this,arguments)},uCW=function(){$N.apply(this,arguments)},zl7=function(){$N.apply(this,arguments)},PEm=function(){$N.apply(this,arguments)},nEB=function(){$N.apply(this,arguments)},j5m=function(){$N.apply(this,arguments)},$2B=function(){$N.apply(this,arguments)},FbC=function(){$N.apply(this,arguments)},yj9=function(){$N.apply(this,arguments)},d20=function(){$N.apply(this,arguments)},el9=function(){$N.apply(this,arguments)},
b2B=function(){$N.apply(this,arguments)},kUB=function(){$N.apply(this,arguments)},Wbc=function(){$N.apply(this,arguments)},O2m=function(){$N.apply(this,arguments)},XRW=function(){$N.apply(this,arguments)},Jje=function(){$N.apply(this,arguments)},KbB=function(){$N.apply(this,arguments)},GUv=function(){$N.apply(this,arguments)},wRc=function(){$N.apply(this,arguments)},lX7=function(){$N.apply(this,arguments)},M_B=function(){$N.apply(this,arguments)},f29=function(){$N.apply(this,arguments)},A_7=function(){$N.apply(this,
arguments)},QQB=function(){$N.apply(this,arguments)},N1C=function(){$N.apply(this,arguments)},Ync=function(){$N.apply(this,arguments)},I2K=function(){$N.apply(this,arguments)},T1K=function(){$N.apply(this,arguments)},D7m=function(M){M=M.key||M.id;
if(!M)throw Error("Entity key is missing");return M},EMc=function(){if(F4)return F4();
var M={};F4=g.Qf("PersistentEntityStoreDb",{Qt:(M.EntityStore={zG:1},M.EntityAssociationStore={zG:2},M),shared:!1,upgrade:function(f,A){A(1)&&g.$k(g.rX(f,"EntityStore",{keyPath:"key"}),"entityType","entityType");A(2)&&(f=g.rX(f,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.$k(f,"byParentEntityKey","parentEntityKey"),g.$k(f,"byChildEntityKey","childEntityKey"))},
version:3});return F4()},t_0=function(M){return g.OL(EMc(),M)},vMW=function(M){return g.OL((0,g.KrC)(),M)},yg=function(M){this.token=M},dd=function(M,f){f=f===void 0?{}:f;
g.GX.call(this,g.Gaw[M],Object.assign({},{name:"PESEncoderError",type:M},f));this.type=M;this.level="WARNING";Object.setPrototypeOf(this,dd.prototype)},pWc=function(M){return new dd("WRONG_DATA_TYPE",{fP:M})},hgW=function(M){return M instanceof Error?new dd("UNKNOWN_ENCODE_ERROR",{originalMessage:M.message}):new dd("UNKNOWN_ENCODE_ERROR")},Sn9=function(M){return M instanceof Error?new dd("UNKNOWN_DECODE_ERROR",{originalMessage:M.message}):new dd("UNKNOWN_DECODE_ERROR")},LCB=function(M,f){M=M instanceof
dd?M:f(M);
g.jZ(M);throw M;},oM0=function(){},C4B=function(M,f,A){try{return M.j(f,A)}catch(Q){LCB(Q,hgW)}},U7W=function(M){M=(new TextEncoder).encode(M).subarray(0,16);
var f=new Uint8Array(16);f.set(M);return f},em=function(M){this.K=M},a2e=function(M){var f=V_e[M];
if(f)return f;g.$b(new g.GX("Entity model not found.",{entityType:M}))},qnB=function(M,f){this.K=M;
this.Z=f;this.j={}},m7R=function(M,f){a:{M=HzB(M.Z,f.version);
try{var A=M.Z(f.data,f.key);break a}catch(Q){LCB(Q,Sn9)}A=void 0}return A},bk=function(M,f,A){return M.K.objectStore("EntityStore").get(f).then(function(Q){if(Q){if(A&&Q.entityType!==A)throw Error("Incorrect entity type");
return m7R(M,Q)}})},kN=function(M,f,A){return A?(A=A.map(function(Q){return bk(M,Q,f)}),g.gX.all(A)):M.K.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(f)).then(function(Q){return Q.map(function(N){return m7R(M,N)})})},O4=function(M,f,A){var Q=D7m(f),N=HzB(M.Z,1),Y=Object.assign({},f);
return M.K.objectStore("EntityStore").get(Q).then(function(I){if(I){if(I.entityType!==A)throw Error("Incorrect entity type");Y.entityMetadata||(I=m7R(M,I),Y.entityMetadata=I.entityMetadata)}}).then(function(){var I={key:Q,
entityType:A,data:C4B(N,Y,Q),version:1};return g.gX.all([g.PY(M.K.objectStore("EntityStore"),I),sQc(M,Y,A)])}).then(function(){W3(M,Q,A);
return Q})},c_K=function(M,f,A){f=f.map(function(Q){return O4(M,Q,A)});
return g.gX.all(f)},X4=function(M,f,A){if(A==null?0:A.EN){var Q=new Set;
return Rgw(M,f,Q).then(function(){for(var Y=[],I=g.V(Q),D=I.next();!D.done;D=I.next())Y.push(X4(M,D.value));return g.gX.all(Y).then(function(){})})}var N=g.M0(f).entityType;
return g.gX.all([M.K.objectStore("EntityStore").delete(f),gM6(M,f)]).then(function(){W3(M,f,N)})},B1e=function(M,f){return g.ej(M.K.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(f)},function(A){return g.gX.all([A.delete(),
gM6(M,A.cursor.primaryKey)]).then(function(){W3(M,A.cursor.primaryKey,f);return g.y$(A)})})},izW=function(M,f,A,Q){var N=HzB(M.Z,1);
return bk(M,f,Q).then(function(Y){if(Y){Y=g.VR(Y,A);var I={key:f,entityType:Q,data:C4B(N,Y,f),version:1};return g.gX.all([g.PY(M.K.objectStore("EntityStore"),I),sQc(M,Y,Q)])}}).then(function(){W3(M,f,Q);
return f})},W3=function(M,f,A){var Q=M.j[A];
Q||(Q=new Set,M.j[A]=Q);Q.add(f)},x7m=function(M,f,A){var Q=D7m(f);
A=a2e(A);if(!A)return g.gX.resolve([]);A=new A(f);M=M.K.objectStore("EntityAssociationStore");f=[];A=g.V(A.Z());for(var N=A.next();!N.done;N=A.next())f.push(g.PY(M,{parentEntityKey:Q,childEntityKey:N.value}));return g.gX.all(f).then(function(Y){return Y.map(function(I){return I[1]})})},gM6=function(M,f){return M.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(f))},sQc=function(M,f,A){var Q=D7m(f);
return gM6(M,Q).then(function(){return x7m(M,f,A)})},Rgw=function(M,f,A){if(A.has(f))return g.gX.resolve(void 0);
A.add(f);return Zzm(M,f).then(function(Q){return M.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(f)).then(function(){return Q})}).then(function(Q){var N=g.gX.resolve(void 0);
Q=g.V(Q);for(var Y=Q.next(),I={};!Y.done;I={oF:void 0},Y=Q.next())I.oF=Y.value,N=N.then(function(D){return function(){return Rgw(M,D.oF,A)}}(I));
return N}).then(function(){})},Zzm=function(M,f){var A=M.K.objectStore("EntityAssociationStore");
return A.index("byParentEntityKey").getAll(IDBKeyRange.only(f)).then(function(Q){var N=[];Q=g.V(Q);for(var Y=Q.next();!Y.done;Y=Q.next())Y=Y.value,N.push(A.index("byChildEntityKey").getAll(Y.childEntityKey));return g.gX.all(N)}).then(function(Q){var N=[];
Q=g.V(Q);for(var Y=Q.next();!Y.done;Y=Q.next())Y=Y.value,Y.length===1&&N.push(Y[0].childEntityKey);return N})},J1=function(){},r_9=function(){this.K={};
this.K[0]=new J1;if(!g.mE("aes_pes_encoder_killswitch")){var M=this.K;try{var f=g.w$();var A=U7W(f);var Q=new em(new g.R_(A),new g.cI(A))}catch(N){throw M=N instanceof Error?new dd("KEY_CREATION_FAILED",{originalMessage:N.message}):new dd("KEY_CREATION_FAILED"),g.jZ(M),M;}M[1]=Q}},HzB=function(M,f){f=f===void 0?0:f;
M=M.K[f];if(!M)throw f=new dd("INVALID_ENCODER_VERSION",{fP:f}),g.jZ(f),f;return M},K9=function(M,f){g.y.call(this);
this.token=M;this.K=f;this.observers=[];M=new g.Kb.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.w$());M.onmessage=this.Z.bind(this);this.channel=M},Gx=function(M,f,A){var Q,N,Y,I;
return g.n(function(D){if(D.Z==1)return g.r(D,t_0(M.token),2);if(D.Z!=3)return Q=D.K,g.r(D,g.zf(Q,["EntityStore","EntityAssociationStore"],f,function(E){N=new qnB(E,M.K);return A(N)}),3);
Y=D.K;N&&(I=N.j,Object.keys(I).length>0&&(M.channel.postMessage(I),udK(M,I)));return D.return(Y)})},wd=function(M,f,A){return Gx(M,{mode:"readwrite",
gq:!0},function(Q){return O4(Q,f,A)})},zge=function(M,f){return Gx(M,{mode:"readwrite",
gq:!0},function(A){return c_K(A,f,"offlineOrchestrationActionWrapperEntity")})},P4c=function(M,f){return Gx(M,{mode:"readwrite",
gq:!0},function(A){return X4(A,f)})},nMB=function(M){return Gx(M,{mode:"readwrite",
gq:!0},function(f){return B1e(f,"videoPlaybackPositionEntity")})},lk=function(M,f,A){return Gx(M,{mode:"readonly",
gq:!0},function(Q){return bk(Q,f,A)})},M$=function(M,f,A){return Gx(M,{mode:"readonly",
gq:!0},function(Q){return kN(Q,f,A)})},udK=function(M,f){M=g.V(M.observers);
for(var A=M.next();!A.done;A=M.next())A=A.value,A(f)},jQC=function(){var M,f,A;
return g.n(function(Q){if(Q.Z==1)return g.HX(Q,2),g.r(Q,g.fr(),4);if(Q.Z!=2){M=Q.K;if(!M||!g.l$()||typeof g.Kb.BroadcastChannel==="undefined")return Q.return();f=new r_9;return Q.return(new K9(M,f))}A=g.id(Q);A instanceof Error&&g.jZ(A);return Q.return()})},fC=function(){$7m||($7m=jQC());
return $7m},FCm=function(M){var f;
M=(f=M.options)==null?void 0:f.persistenceOption;return M==="ENTITY_PERSISTENCE_OPTION_PERSIST"||M==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},y_7=function(M){var f;
return g.n(function(A){return A.Z==1?g.r(A,fC(),2):(f=A.K)?g.r(A,Gx(f,"readwrite",function(Q){for(var N={},Y=g.V(M),I=Y.next(),D={};!I.done;D={Ro:void 0,Dc:void 0},I=Y.next())D.Ro=I.value,D.Ro.entityKey&&FCm(D.Ro)&&(D.Dc=g.OB(D.Ro.payload),I=void 0,D.Ro.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(I=function(E){return function(){return O4(Q,E.Ro.payload[E.Dc],E.Dc)}}(D)),D.Ro.type==="ENTITY_MUTATION_TYPE_DELETE"&&(I=function(E){return function(){return X4(Q,E.Ro.entityKey)}}(D)),D.Ro.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(I=function(E){return function(){return izW(Q,E.Ro.entityKey,E.Ro.payload[E.Dc],E.Dc)}}(D)),I&&(N[D.Ro.entityKey]=N[D.Ro.entityKey]?N[D.Ro.entityKey].then(I):I()));
return g.gX.all(Object.values(N))}),0):A.return()})},d76=function(M){var f;
return g.n(function(A){if(A.Z==1){f=M.mutations;if(!f||f.length<=0)return A.return();if(g.Te){var Q={type:"ENTITY_LOADED"};f!==void 0&&(Q.payload=f);g.Te.dispatch(Q)}return g.r(A,y_7(f),2)}f.length=0;g.qc(A)})},egv=function(M){return M!==void 0},bzm=function(M){var f=g.P5();
f=Object.assign({},f);M=Object.assign({},M);for(var A in f)M[A]?(f[A]!==4&&(f[A]=M[A]),delete M[A]):f[A]!==2&&(f[A]=4);Object.assign(f,M);g.CFX(f);JSON.stringify(f);return f},kgC=function(M){var f,A;
return g.n(function(Q){if(Q.Z==1)return g.r(Q,g.fr(),2);if(Q.Z!=3)return(f=Q.K)?g.r(Q,g.$s(f),3):Q.return();A=Q.K;return Q.return(g.zf(A,["index","media","captions"],{mode:"readwrite",gq:!0},function(N){var Y=IDBKeyRange.bound(M+"|",M+"~");N=[N.objectStore("index").delete(Y),N.objectStore("media").delete(Y),N.objectStore("captions").delete(Y)];return g.gX.all(N).then(function(){})}))})},WCv=function(){var M,f;
return g.n(function(A){if(A.Z==1)return g.r(A,g.fr(),2);if(A.Z!=3){M=A.K;if(!M)throw g.cY("rvdfd");return g.r(A,g.$s(M),3)}f=A.K;return A.return(g.zf(f,["index","media"],{mode:"readwrite",gq:!0},function(Q){var N={};return g.F3(Q.objectStore("index"),{},function(Y){var I=Y.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),D=g.gX.resolve(void 0);if(I){var E=I[1];I=I[2];N[E]=N[E]||{};var t;N[E][I]=g.Hdd((t=Y.getValue())==null?void 0:t.fmts)}else D=Y.delete().then(function(){});
return g.gX.all([g.y$(Y),D]).then(function(v){return g.V(v).next().value})}).then(function(){for(var Y={},I=g.V(Object.keys(N)),D=I.next();!D.done;D=I.next()){D=D.value;
var E=N[D].v;Y[D]=N[D].a&&E?1:2}var t=bzm(Y);return g.urt(Q.objectStore("media"),{},function(v){var p=v.cursor.key.match(g.Rq9);p&&Y[p[1]]||Q.objectStore("media").delete(v.cursor.key);return g.sAU(v)}).then(function(){return t})})}))})},OzB=function(M,f){var A,Q;
return g.n(function(N){if(N.Z==1)return g.r(N,g.fr(),2);if(N.Z!=3){A=N.K;if(!A)throw g.cY("wct");return g.r(N,g.$s(A),3)}Q=N.K;return g.r(N,g.zf(Q,["captions"],{mode:"readwrite",gq:!0},function(Y){var I=[];Y=Y.objectStore("captions");for(var D=0;D<f.length;D++){var E=g.PY(Y,f[D],M+"|"+f[D].metadata.vss_id);I.push(E)}return g.gX.all(I)}),0)})},XW9=function(M){var f,A,Q;
return g.n(function(N){if(N.Z==1)return f=IDBKeyRange.bound(M+"|",M+"~"),g.r(N,g.fr(),2);if(N.Z!=3){A=N.K;if(!A)throw g.cY("gactfv");return g.r(N,g.$s(A),3)}Q=N.K;return N.return(Q.getAll("captions",f))})},J_e=function(M){return g.n(function(f){g.jH(M,0);
return f.return(kgC(M))})},KCv=function(M){return{context:g.fp(),
videoIds:M}},Ggc=function(M){return{context:g.fp(),
playlistIds:M}},wW9=function(M){return{context:g.fp(),
offlinePlaylistSyncChecks:M}},l29=function(){this.K=new Map},fRe=function(){MM7||(MM7=new l29);
return MM7},Aww=function(M,f){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:M},metadata:f,statusCode:void 0,csn:void 0,can:void 0}},QcC=function(M,f,A){if(!A){var Q=Q===void 0?!1:Q;
A=M.K.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!A||Q)A=g.RP(16),M.K.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",A)}M={flowNonce:A,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:f.eventType};f.metadata&&(M.flowMetadata=f.metadata);f.statusCode!==void 0&&(M.flowEventStatus=f.statusCode);f.csn&&(M.csn=f.csn);f.can&&(M.can=f.can);g.hO("flowEvent",M,void 0)},NaC=function(M){var f,A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK,x9,gD,TC,H,DU,JB,sI;
return g.n(function(Zv){if(Zv.Z==1)return g.r(Zv,Gx(M,{mode:"readonly",gq:!0},function(UB){return kN(UB,"playbackData").then(function(FT){var jw=FT.map(function(Z){return Z.transfer}).filter(function(Z){return!!Z}),r7=FT.map(function(Z){return Z.offlineVideoPolicy}).filter(function(Z){return!!Z}),B=FT.filter(function(Z){return!!Z.key}).map(function(Z){return g.fZ(g.M0(Z.key).entityId,"downloadStatusEntity")});
jw=kN(UB,"transfer",jw);r7=kN(UB,"offlineVideoPolicy",r7);B=kN(UB,"downloadStatusEntity",B);var x=jw.then(function(Z){Z=Z.reduce(function(P,k){(k==null?0:k.offlineVideoStreams)&&P.push.apply(P,g.c(k.offlineVideoStreams));return P},[]).filter(function(P){return!!P});
return kN(UB,"offlineVideoStreams",Z)});
return g.gX.all([jw,r7,x,B]).then(function(Z){var P=g.V(Z);Z=P.next().value;var k=P.next().value;var cX=P.next().value;P=P.next().value;return[FT,Z,k,cX,P]})})}),2);
if(Zv.Z!=3)return f=Zv.K,g.r(Zv,Gx(M,{mode:"readonly",gq:!0},function(UB){return kN(UB,"mainDownloadsListEntity").then(function(FT){var jw,r7;return(r7=(jw=FT[0])==null?void 0:jw.downloads)!=null?r7:[]})}),3);
A=Zv.K;Q=g.V(f);N=Q.next().value;Y=Q.next().value;I=Q.next().value;D=Q.next().value;E=Q.next().value;t=N;v=Y;p=I;h=D;S=E;L={};a={};q={};m={};R={};u=[];z=g.V(v);for(e=z.next();!e.done;e=z.next())(G=e.value)&&(L[G.key]=G);X=g.V(p);for(Qt=X.next();!Qt.done;Qt=X.next())(Y9=Qt.value)&&(a[Y9.key]=Y9);Mc=g.V(S);for(E0=Mc.next();!E0.done;E0=Mc.next())(w=E0.value)&&(q[w.key]=w);m6=g.V(h);for(BX=m6.next();!BX.done;BX=m6.next())(WX=BX.value)&&(m[WX.key]=WX);g7=g.V(A);for(vK=g7.next();!vK.done;vK=g7.next())x9=
vK.value,gD=void 0,R[(gD=x9.videoItem)!=null?gD:""]=!0,x9.videoItem&&(H=TC=void 0,DU=(H=(TC=g.M0(x9.videoItem))==null?void 0:TC.entityId)!=null?H:"",u.push({externalVideoId:DU}));JB=t.filter(function(UB){if(!UB||!UB.key||!UB.offlineVideoPolicy)return!1;UB=g.M0(UB.key).entityId;UB=g.fZ(UB,"downloadStatusEntity");var FT;return!(UB&&((FT=q[UB])==null?void 0:FT.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
sI=JB.map(function(UB){var FT=L[UB.transfer],jw=[];if(FT==null?0:FT.offlineVideoStreams)for(var r7=g.V(FT.offlineVideoStreams),B=r7.next();!B.done;B=r7.next())(B=m[B.value])&&jw.push(B);r7=a[UB.offlineVideoPolicy];B=R;var x=UB==null?void 0:UB.playerResponseTimestamp,Z=g.M0(r7.key).entityId;UB=g.fZ(Z,"mainVideoEntity");if(r7.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var P="OFFLINE_VIDEO_STATE_DISABLED";r7.expirationTimestamp&&Number(r7.expirationTimestamp)<Date.now()/1E3&&(P="OFFLINE_VIDEO_STATE_EXPIRED")}else if(r7.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")P="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(FT==null?void 0:FT.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":P="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":P="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":P="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":P="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":P="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":P="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:P="OFFLINE_VIDEO_STATE_UNKNOWN"}if(P==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(FT==null?void 0:FT.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":P="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":P="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":P=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Z={id:Z,videoState:P};if(FT==null?0:FT.cotn)Z.cotn=FT.cotn;if(FT==null?0:FT.maximumDownloadQuality)Z.selectedVideoQuality=FT==null?void 0:FT.maximumDownloadQuality;if(FT==null?0:FT.lastProgressTimeMs)Z.lastProgressTimeMs=FT.lastProgressTimeMs;x&&(Z.playerResponseSavedTimeMs=String(Number(x)*1E3));FT=String;x=0;jw=g.V(jw);for(P=jw.next();!P.done;P=jw.next())if(P=P.value,P.streamsProgress){P=g.V(P.streamsProgress);for(var k=P.next();!k.done;k=P.next()){var cX=void 0;
x+=Number((cX=k.value.numBytesDownloaded)!=null?cX:0)}}Z.downloadedBytes=FT(x);Z.selectedOfflineMode=B[UB]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";r7.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Z.offlinePlaybackDisabledReason=r7.offlinePlaybackDisabledReason);return Z});
return Zv.return({offlineVideos:sI,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:u}}})})},YJC=function(){this.locks=navigator.locks},IRv=function(){try{var M=g.wD("ytglobal.locks_");
if(M)return M;var f;if(f=navigator){var A=navigator;f="locks"in A&&!!A.locks}if(f)return g.Kb.localStorage&&g.Kb.localStorage.getItem("noop"),M=new YJC,g.Gz("ytglobal.locks_",M),M}catch(Q){}},Ai=function(){},Ta6=function(){},Dlw=function(M){if(M.includes(":"))throw Error("Invalid user cache name: "+M);
return M+":"+g.w$("CacheStorage get")},EWK=function(){return g.n(function(M){if(QD!==void 0)return M.return(QD);
QD=new Promise(function(f){var A;return g.n(function(Q){switch(Q.Z){case 1:return g.HX(Q,2),g.r(Q,N$.open("test-only"),4);case 4:return g.r(Q,N$.delete("test-only"),5);case 5:g.Rf(Q,3);break;case 2:if(A=g.id(Q),A instanceof Error&&A.name==="SecurityError")return f(!1),Q.return();case 3:f("caches"in window),g.qc(Q)}})});
return M.return(QD)})},vWv=function(){return g.n(function(M){if(M.Z==1)return g.r(M,EWK(),2);
if(!M.K)return M.return(void 0);tM0||(tM0=new Ta6);return M.return(tM0)})},Yh=function(M,f,A){g.$b(new g.GX("Woffle: "+M,A?{cotn:A}:""));
f instanceof Error&&g.$b(f)},piK=function(M){var f;
return g.n(function(A){if(A.Z==1)return g.r(A,NaC(M),2);f=A.K;g.hO("offlineStateSnapshot",f);g.qc(A)})},Is=function(M){g.y.call(this);
var f=this;this.api=M;this.Ed={WJ$:function(){return f.K},
sZ8:function(){return f.Z}};
typeof g.Kb.BroadcastChannel!=="undefined"&&(this.K=new g.Kb.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.w$()),this.K.onmessage=this.j.bind(this),this.Z=new g.Kb.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.w$()),this.Z.onmessage=this.C.bind(this))},Th=function(M,f){M.api.T0("onOfflineOperationFailure",f);
var A;(A=M.K)==null||A.postMessage(f)},h2W=function(M,f,A,Q){var N=this;
this.X=M;this.B=f;this.visibility=A;this.V=Q;this.N=this.W=this.G=this.j=this.K=!1;this.C=new g.MY(function(){N.Jj()});
this.Ed={kW:function(){return N.Z},
Jj:function(){N.Jj()},
thN:function(){return N.C}};
this.visibility.subscribe("visibilitystatechange",function(){N.Zy()})},SJK=function(M){if(!M.j&&!M.K){var f=IRv();
if(f){M.j=!0;var A=g.w$("OfflineLockManager");f.request("woffle_orchestration_leader:"+A,{},function(){var Q,N,Y,I;return g.n(function(D){switch(D.Z){case 1:return g.HX(D,2),M.Z=new g.LB,M.K=!0,M.j=!1,g.r(D,M.X(),4);case 4:return g.r(D,M.Z.promise,5);case 5:g.Rf(D,0);break;case 2:Q=g.id(D),((Y=(N=M).V)==null?0:Y.call(N,"wo_relinquish_leadership_on_lock_request_error"))||M.Jj(),Q instanceof Error&&(I=Q,I.args=[{name:"WoLockManagerError",j3:Q.name}],g.jZ(I)),g.qc(D)}})})}}},LBw=function(M){M.K&&(M.N=
!0,DW(M))},oWe=function(M,f){M.K&&(M.G=f,DW(M))},CRB=function(M,f){M.K&&(M.W=f,DW(M))},DW=function(M){M.W&&M.G&&M.N&&M.visibility.isBackground()?g.f5(M.C,6E4):M.C.stop()},Er=function(M){var f;
M.offlineDeleteReason=(f=M.offlineDeleteReason)!=null?f:"OFFLINE_DELETE_REASON_UNKNOWN";var A;M.offlineModeType=(A=M.offlineModeType)!=null?A:"OFFLINE_NOW";g.hO("offlineDeleteEvent",M)},ti=function(M,f){var A=f.videoId;
var Q=f.BB;f=f.offlineModeType;M.encryptedVideoId=A;M.cotn=Q==null?void 0:Q.cotn;M.offlineabilityFormatType=Q==null?void 0:Q.maximumDownloadQuality;var N;M.isRefresh=(N=Q==null?void 0:Q.isRefresh)!=null?N:!1;var Y;M.softErrorCount=(Y=Q==null?void 0:Q.transferRetryCount)!=null?Y:0;M.offlineModeType=f!=null?f:"OFFLINE_NOW";(M.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&M.statusType==="UNKNOWN_STATUS_TYPE"||!M.transferStatusType&&!M.statusType)&&g.$b(Error("Woffle unknown transfer status"));
g.hO("offlineTransferStatusChanged",M)},UlR=function(M){ti({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},M)},VM6=function(M,f,A,Q){Q={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!Q};f&&A&&(f=Math.floor(f/1024).toFixed(),A=Math.floor(A/1024).toFixed(),Q.alreadyDownloadedKbytes=f,Q.totalFetchedKbytes=f,Q.totalContentKbytes=A);ti(Q,M)},aRW=function(M){ti({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},M)},qJe=function(M){ti({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},M)},HBB=function(M){switch(M){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
v0=function(M){var f,A,Q;
return((Q=(f=M.actionMetadata)==null?void 0:(A=f.retryScheduleIntervalsInSeconds)==null?void 0:A.length)!=null?Q:0)>0},pC=function(M){return M.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!M.entityKey},hi=function(M){return M.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!M.entityKey},S6=function(M){return M.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!M.entityKey},mlm=function(M){return M.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!M.entityKey},
LC=function(M,f,A,Q,N){N=N===void 0?!1:N;
var Y,I,D,E,t,v;return g.n(function(p){if(p.Z==1)return Y=g.fZ(M,f),I=g.fZ(M,"downloadStatusEntity"),g.r(p,Gx(A,{mode:"readonly",gq:!0},function(h){return g.gX.all([bk(h,Y,f),bk(h,I,"downloadStatusEntity")])}),2);
D=p.K;E=D.length?D[0]:void 0;if(!E)return p.CJ(0);t=sc9;if(v=D.length>1?D[1]:void 0){if(v.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!N)return p.return();v.downloadState=Q}else v={key:I,downloadState:Q};g.bH(E,t,v);return g.r(p,Gx(A,{mode:"readwrite",gq:!0},function(h){return g.gX.all([O4(h,E,f),O4(h,v,"downloadStatusEntity")])}),0)})},os=function(M,f){return M.actionType===f.actionType&&M.entityKey===f.entityKey},CC=function(M,f){if(M&&M.transferState!=="TRANSFER_STATE_COMPLETE"&&M.transferState!==
"TRANSFER_STATE_FAILED"){var A=g.M0(M.key).entityId;
ti({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:A,BB:M,offlineModeType:f})}},Ur=function(M){if(!M||!M.thumbnails)return[];
var f=[];M=g.V(M.thumbnails);for(var A=M.next();!A.done;A=M.next())A=A.value,A.url&&f.push(A.url);return f},cwK=function(M,f,A){A=A===void 0?[]:A;
var Q,N,Y,I,D,E,t,v,p,h,S,L,a;return g.n(function(q){if(q.Z==1)return A.length?g.r(q,M$(M,f),2):q.return([]);Q=q.K;N=new Set;Y=g.V(Q);for(I=Y.next();!I.done;I=Y.next())if(D=I.value,E=D.id||D.key)t=g.M0(E).entityId,N.add(t);v=[];p=g.V(A);for(h=p.next();!h.done;h=p.next())S=h.value,L=S.offlineVideoData,a=void 0,((a=L)==null?0:a.videoId)&&!N.has(L.videoId)&&v.push(S);return q.return(v)})},R2B=function(M,f,A){return new g.G9(M,{cotn:f,
raw_player_response:A,download_media:!0,start:Infinity,disable_watch_next:!0})},gWm=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},VD=function(M,f,A,Q,N,Y,I,D,E,t,v){this.entityType=M;
this.actionId=f;this.action=A;this.parentActionId=Q;this.rootActionId=N===void 0?f:N;this.childActionIds=Y;this.prereqActionId=I;this.postreqActionIds=D;this.hasChildActionFailed=t;this.retryScheduleIndex=0;this.K=v||Date.now();this.retryScheduleIndex=E||0},as=function(M){if(!M.key)throw Error("Entity key is required.");
if(!M.actionProto)throw Error("OfflineOrchestrationAction is required.");var f=g.M0(M.key),A=g.M0(M.actionProto.entityKey);return new VD(A.entityType,f.entityId,M.actionProto,M.parentActionId,M.rootActionId,M.childActionIds,M.prereqActionId,M.postreqActionIds,M.retryScheduleIndex,M.hasChildActionFailed,Number(M.enqueueTimeSec)*1E3)},q$=function(M){return{key:g.fZ(M.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:M.action,parentActionId:M.parentActionId,rootActionId:M.rootActionId,childActionIds:M.childActionIds,prereqActionId:M.prereqActionId,postreqActionIds:M.postreqActionIds,retryScheduleIndex:M.retryScheduleIndex,hasChildActionFailed:M.hasChildActionFailed,enqueueTimeSec:(M.K/1E3).toFixed()}},Bam=function(){var M;
return g.n(function(f){return f.Z==1?g.r(f,vWv(),2):(M=f.K)?f.return(M.delete("yt-player-local-img")):f.return(!0)})},H0=function(M){var f,A;
return g.n(function(Q){if(Q.Z==1)return g.r(Q,vWv(),2);if(Q.Z!=3){f=Q.K;if(!f)throw Error("Cache API not supported");return M.length?g.r(Q,f.open("yt-player-local-img"),3):Q.return()}A=Q.K;return g.r(Q,Promise.all(M.map(function(N){return A.delete(N)})),0)})},m7=function(M){var f,A;
return g.n(function(Q){if(Q.Z==1)return g.r(Q,vWv(),2);if(Q.Z!=3){f=Q.K;if(!f)throw Error("Cache API not supported");return M.length?g.r(Q,f.open("yt-player-local-img"),3):Q.return()}A=Q.K;return g.r(Q,A.addAll(M),0)})},sr=function(M,f,A,Q,N){var Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK,x9,gD;
return g.n(function(TC){switch(TC.Z){case 1:return Y=g.fZ(M,"mainVideoEntity"),I=g.fZ(M,"ytMainChannelEntity"),D=g.fZ(M,"transfer"),E=g.fZ(M,"videoDownloadContextEntity"),g.r(TC,Gx(f,{mode:"readonly",gq:!0},function(H){return g.gX.all([bk(H,Y,"mainVideoEntity"),bk(H,I,"ytMainChannelEntity"),bk(H,D,"transfer"),bk(H,E,"videoDownloadContextEntity"),kN(H,"ytMainChannelEntity"),kN(H,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:t=TC.K;v=g.V(t);p=v.next().value;h=v.next().value;S=v.next().value;L=v.next().value;a=v.next().value;q=v.next().value;m=p;R=h;u=S;z=L;e=a;G=q;if(!m&&!R){TC.CJ(3);break}X=m?Ur(m.thumbnail):[];if(!R){Qt=[];TC.CJ(4);break}return g.r(TC,iBW(R,e),5);case 5:Qt=TC.K;case 4:return Y9=Qt,g.r(TC,H0(X.concat(Y9)),3);case 3:Mc=[];E0=g.fZ(M,"downloadStatusEntity");w=g.V(G);for(m6=w.next();!m6.done;m6=w.next())BX=m6.value,WX=g.M0(BX.key).entityId,g7=as(BX),vK=g.M0(g7.action.entityKey).entityId,WX!==M&&vK!==
M||os(A,BX.actionProto)||Mc.push(BX.key);return g.r(TC,Gx(f,{mode:"readwrite",gq:!0},function(H){var DU=Mc.map(function(JB){return X4(H,JB)});
DU.push(X4(H,Y,{EN:!0}));DU.push(X4(H,E0,{EN:!0}));return g.gX.all(DU)}),7);
case 7:gD=(x9=z)==null?void 0:x9.offlineModeType,N&&(Er(N),N.offlineModeType&&(gD=N.offlineModeType)),CC(u,gD),Th(Q,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.qc(TC)}})},rwR=function(M,f,A,Q){var N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK,x9,gD,TC,H,DU,JB,sI,Zv,UB,FT,jw,r7,B,x,Z,P,k,cX,Ab,af;
return g.n(function(Nc){switch(Nc.Z){case 1:return N=g.fZ(M,"mainPlaylistEntity"),Y=g.fZ(M,"ytMainChannelEntity"),g.r(Nc,Gx(f,{mode:"readonly",gq:!0},function(rD){return g.gX.all([bk(rD,N,"mainPlaylistEntity"),bk(rD,Y,"ytMainChannelEntity"),kN(rD,"mainPlaylistEntity"),kN(rD,"mainDownloadsListEntity"),kN(rD,"ytMainChannelEntity"),kN(rD,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:I=Nc.K;D=g.V(I);E=D.next().value;t=D.next().value;v=D.next().value;p=D.next().value;h=D.next().value;S=D.next().value;L=E;a=t;q=v;m=p;R=h;u=S;if(!L&&!a){Nc.CJ(3);break}z=L?xlc(L):[];if(!a){e=[];Nc.CJ(4);break}return g.r(Nc,iBW(a,R),5);case 5:e=Nc.K;case 4:return G=e,g.r(Nc,H0(z.concat(G)),3);case 3:X=[];Qt=new Map;if(!L){Nc.CJ(7);break}return g.r(Nc,ZB9(L,q,m),8);case 8:X=Nc.K;Y9=g.V(X);for(Mc=Y9.next();!Mc.done;Mc=Y9.next())E0=Mc.value,Qt.set(E0,{videoId:E0,playlistId:M,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.r(Nc,Gx(f,{mode:"readonly",gq:!0},function(rD){return g.gX.all([kN(rD,"transfer"),kN(rD,"videoDownloadContextEntity")])}),9);
case 9:w=Nc.K;m6=g.V(w);BX=m6.next().value;WX=m6.next().value;g7=BX;vK=WX;x9=g.V(g7);for(gD=x9.next();!gD.done;gD=x9.next())TC=gD.value,H=g.M0(TC.key).entityId,(DU=Qt.get(H))&&TC&&(DU.cotn=TC.cotn);JB=g.V(vK);for(sI=JB.next();!sI.done;sI=JB.next())Zv=sI.value,UB=g.M0(Zv.key).entityId,(FT=Qt.get(UB))&&Zv&&(FT.offlineModeType=Zv.offlineModeType);case 7:jw=[];r7=g.V(u);for(B=r7.next();!B.done;B=r7.next())x=B.value,Z=g.M0(x.key).entityId,P=as(x),Z!==M&&P.rootActionId!==M||os(A,x.actionProto)||jw.push(x.key);
k=g.fZ(M,"mainPlaylistEntity");return g.r(Nc,Gx(f,{mode:"readwrite",gq:!0},function(rD){var ld=jw.map(function(cK){return X4(rD,cK)});
ld.push(X4(rD,k,{EN:!0}));return g.gX.all(ld)}),10);
case 10:if(!L){Nc.CJ(0);break}X.reverse();if(!X){Nc.CJ(0);break}cX=g.V(X);Ab=cX.next();case 13:if(Ab.done){Nc.CJ(0);break}af=Ab.value;return g.r(Nc,sr(af,f,A,Q,Qt.get(af)),14);case 14:Ab=cX.next(),Nc.CJ(13)}})},z2c=function(M,f,A,Q){var N,Y,I,D,E,t,v,p,h;
return g.n(function(S){if(S.Z==1)return N=g.fZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),Y=new Map,g.r(S,Gx(M,{mode:"readwrite",gq:!0},function(L){var a=kN(L,"transfer"),q=kN(L,"offlineOrchestrationActionWrapperEntity"),m=kN(L,"videoDownloadContextEntity"),R=bk(L,N,"mainDownloadsListEntity");return g.gX.all([a,q,m,R]).then(function(u){u=g.V(u);var z=u.next().value;var e=u.next().value;var G=u.next().value;var X=u.next().value;u=uj6.map(function(Y9){return B1e(L,Y9)});
e=g.V(e);for(var Qt=e.next();!Qt.done;Qt=e.next())Qt=Qt.value,os(f,Qt.actionProto)||u.push(X4(L,Qt.key,{EN:!0}));X&&(X.downloads=[],u.push(O4(L,X,"mainDownloadsListEntity")));if(G)for(G=g.V(G),X=G.next();!X.done;X=G.next())X=X.value,e=g.M0(X.key).entityId,e=g.fZ(e,"transfer"),Y.set(e,X.offlineModeType);return g.gX.all(u).then(function(){return z})})}),2);
I=S.K;D=g.V(I);for(E=D.next();!E.done;E=D.next())t=E.value,CC(t,Y.get(t.key)),v=g.M0(t.key).entityId,p={videoId:v,offlineDeleteReason:Q,cotn:t.cotn,offlineModeType:Y.get(t.key)},Er(p),h=g.fZ(v,"mainVideoEntity"),Th(A,{entityKey:h,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.r(S,Bam(),0)})},xlc=function(M,f){var A=[];
if(M.thumbnailStyleData){M=g.V(M.thumbnailStyleData);for(var Q=M.next();!Q.done;Q=M.next()){var N=void 0,Y=void 0,I=void 0;A=A.concat(Ur((N=Q.value)==null?void 0:(Y=N.value)==null?void 0:(I=Y.collageThumbnail)==null?void 0:I.coverThumbnail))}}f=Ur(f);return A.concat(f)},ZB9=function(M,f,A){var Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9;
return g.n(function(Mc){Q=[];N=new Set;if(A.length)for(Y=g.V(A),I=Y.next();!I.done;I=Y.next())if(D=I.value,E=void 0,(E=D.downloads)==null?0:E.length)for(t=g.V(D.downloads),v=t.next();!v.done;v=t.next())p=v.value,p.videoItem&&(h=g.M0(p.videoItem).entityId,N.add(h));if(M.videos){S=g.V(M.videos);for(L=S.next();!L.done;L=S.next())a=L.value,q=JSON.parse(g.M0(a).entityId),q.videoId&&!N.has(q.videoId)&&Q.push(q.videoId);m=g.V(f);for(R=m.next();!R.done;R=m.next())if(u=R.value,u.key!==M.key&&(z=u.videos))for(e=
g.V(z),G=e.next();!G.done;G=e.next())X=G.value,Qt=JSON.parse(g.M0(X).entityId),Qt.videoId&&(Y9=Q.indexOf(Qt.videoId),Y9!==-1&&Q.splice(Y9,1))}return Mc.return(Q)})},iBW=function(M,f){var A,Q,N,Y,I,D,E,t;
return g.n(function(v){A=Ur(M.avatar);Q=g.V(f);for(N=Q.next();!N.done;N=Q.next())if(Y=N.value,Y.id!==M.id)for(I=g.V(Ur(Y.avatar)),D=I.next();!D.done;D=I.next())E=D.value,t=A.indexOf(E),t!==-1&&A.splice(t,1);return v.return(A)})},PRC=function(M){var f;
return g.n(function(A){f=g.b(M.frameworkUpdates,c0);return M.frameworkUpdates&&f?g.r(A,d76(f),0):A.return()})},jcB=function(M){var f;
if((f=M.onResponseReceivedActions)!=null&&f.length){var A;M=(A=g.b(g.b(M.onResponseReceivedActions[0],nWe),g.XTe))==null?void 0:A.actions;if(M!=null&&M.length)return M}},$l9=function(M){var f,A,Q;
return g.n(function(N){if(N.Z==1)return M?g.r(N,lk(M,g.nR,"mainDownloadsListEntity"),2):N.return([]);f=N.K;return((A=f)==null?0:(Q=A.downloads)==null?0:Q.length)?N.return(f.downloads.map(function(Y){var I;return(I=Y.videoItem)!=null?I:""})):N.return([])})},ywW=function(M,f){var A;
return g.n(function(Q){return Q.Z==1?g.r(Q,FBw(M,f),2):(A=Q.K)?g.r(Q,Gx(M,{mode:"readwrite",gq:!0},function(N){var Y=[O4(N,A.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];A.mainDownloadsListEntity&&Y.push(O4(N,A.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.gX.all(Y)}),0):Q.CJ(0)})},FBw=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u;
return g.n(function(z){if(z.Z==1)return A=g.fZ("main_downloads_library_id","mainDownloadsLibraryEntity"),Q=g.fZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.r(z,Gx(M,{mode:"readonly",gq:!0},function(e){return g.gX.all([bk(e,A,"mainDownloadsLibraryEntity"),bk(e,Q,"mainDownloadsListEntity")])}),2);
N=z.K;Y=g.V(N);I=Y.next().value;D=Y.next().value;E=I;t=D;E||(E={id:A});v=g.V(f);for(p=v.next();!p.done;p=v.next())if(h=p.value,h===g.nR){if(E.smartDownloadsList)return z.return();E.smartDownloadsList=h}else if(S=g.M0(h).entityType,L={},S==="mainPlaylistEntity"?L.playlistItem=h:S==="mainVideoEntity"&&(L.videoItem=h),!g.MV(L)){a=void 0;if((a=t)==null?0:a.downloads){q=!1;m=g.V(t.downloads);for(R=m.next();!R.done;R=m.next())if(u=R.value,u.playlistItem===h||u.videoItem===h){q=!0;break}q||t.downloads.push(L)}else t=
{id:Q,downloads:[L]};E.downloadsList=Q}return z.return({mainDownloadsLibraryEntity:E,mainDownloadsListEntity:t})})},dlK=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q;
return g.n(function(m){if(m.Z==1)return A=g.fZ("main_downloads_library_id","mainDownloadsLibraryEntity"),Q=g.fZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.r(m,Gx(M,{mode:"readonly",gq:!0},function(R){return g.gX.all([bk(R,A,"mainDownloadsLibraryEntity"),bk(R,Q,"mainDownloadsListEntity"),bk(R,g.nR,"mainDownloadsListEntity")])}),2);
N=m.K;Y=g.V(N);I=Y.next().value;D=Y.next().value;E=Y.next().value;t=I;v=D;p=E;if(!t)return m.CJ(0);if(f===g.nR&&((h=p)==null?0:h.downloads))p.downloads=[];else if((S=v)==null?0:S.downloads)for(L=g.M0(f).entityType,a=0;a<v.downloads.length;a++)if(q=v.downloads[a],L==="mainVideoEntity"&&q.videoItem===f){v.downloads.splice(a,1);break}else if(L==="mainPlaylistEntity"&&q.playlistItem===f){v.downloads.splice(a,1);break}return g.r(m,Gx(M,{mode:"readwrite",gq:!0},function(R){var u=[O4(R,t,"mainDownloadsLibraryEntity")];
v&&u.push(O4(R,v,"mainDownloadsListEntity"));p&&u.push(O4(R,p,"mainDownloadsListEntity"));return g.gX.all(u)}),0)})},Rs=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h;
return g.n(function(S){if(S.Z==1)return A=g.fZ(f,"transfer"),Q=g.fZ(f,"videoDownloadContextEntity"),g.r(S,Gx(M,{mode:"readonly",gq:!0},function(L){return g.gX.all([bk(L,A,"transfer"),bk(L,Q,"videoDownloadContextEntity")])}),2);
N=S.K;Y=g.V(N);I=Y.next().value;D=Y.next().value;E=I;t=D;h={videoId:f,cotn:(v=E)==null?void 0:v.cotn,offlineModeType:(p=t)==null?void 0:p.offlineModeType};return S.return(h)})},gl=function(M,f,A,Q,N){var Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt;
return g.n(function(Y9){switch(Y9.Z){case 1:return Y=g.fZ(M,"musicTrack"),I=g.fZ(M,"transfer"),g.r(Y9,Gx(f,{mode:"readonly",gq:!0},function(Mc){return g.gX.all([bk(Mc,Y,"musicTrack"),bk(Mc,I,"transfer"),kN(Mc,"musicTrack"),kN(Mc,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=Y9.K;E=g.V(D);t=E.next().value;v=E.next().value;p=E.next().value;h=E.next().value;S=t;L=v;a=p;q=h;if(!S){Y9.CJ(3);break}return g.r(Y9,e26(S,a),4);case 4:return m=Y9.K,g.r(Y9,H0(m),3);case 3:R=[];u=g.V(q);for(z=u.next();!z.done;z=u.next())e=z.value,G=g.M0(e.key).entityId,X=as(e),Qt=g.M0(X.action.entityKey).entityId,G!==M&&Qt!==M||os(A,e.actionProto)||R.push(e.key);return g.r(Y9,Gx(f,{mode:"readwrite",gq:!0},function(Mc){var E0=R.map(function(w){return X4(Mc,w)});
E0.push(X4(Mc,Y,{EN:!0}));return g.gX.all(E0)}),6);
case 6:CC(L),N&&Er(N),Th(Q,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.qc(Y9)}})},B0=function(M,f,A,Q,N){var Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK,x9,gD,TC,H,DU,JB,sI;
return g.n(function(Zv){switch(Zv.Z){case 1:return Y=g.fZ(M,f),I=g.fZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.r(Zv,Gx(A,{mode:"readonly",gq:!0},function(UB){return g.gX.all([bk(UB,Y,f),bk(UB,I,"musicDownloadsLibraryEntity"),kN(UB,f),kN(UB,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:D=Zv.K;E=g.V(D);t=E.next().value;v=E.next().value;p=E.next().value;h=E.next().value;S=t;L=v;a=p;q=h;if(!S){Zv.CJ(3);break}return g.r(Zv,e26(S,a),4);case 4:return m=Zv.K,g.r(Zv,H0(m),3);case 3:R=[];u=new Map;if(!S){Zv.CJ(6);break}return g.r(Zv,bB6(S,a,L),7);case 7:R=Zv.K;z=g.V(R);for(e=z.next();!e.done;e=z.next())G=e.value,X=g.M0(G).entityId,u.set(X,{videoId:X,playlistId:M,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.r(Zv,M$(A,"transfer"),8);case 8:for(Qt=Zv.K,Y9=
g.V(Qt),Mc=Y9.next();!Mc.done;Mc=Y9.next())E0=Mc.value,w=g.M0(E0.key).entityId,(m6=u.get(w))&&E0&&(m6.cotn=E0.cotn);case 6:BX=[];WX=g.V(q);for(g7=WX.next();!g7.done;g7=WX.next())vK=g7.value,x9=g.M0(vK.key).entityId,gD=as(vK),x9!==M&&gD.rootActionId!==M||os(Q,vK.actionProto)||BX.push(vK.key);TC=g.fZ(M,f);return g.r(Zv,Gx(A,{mode:"readwrite",gq:!0},function(UB){var FT=BX.map(function(jw){return X4(UB,jw)});
FT.push(X4(UB,TC,{EN:!0}));return g.gX.all(FT)}),9);
case 9:if(!S){Zv.CJ(0);break}R.reverse();if(!R.length){Zv.CJ(0);break}H=g.V(R);DU=H.next();case 12:if(DU.done){Zv.CJ(0);break}JB=DU.value;sI=g.M0(JB).entityId;if(!sI){Zv.CJ(13);break}return g.r(Zv,gl(sI,A,Q,N,u.get(sI)),13);case 13:DU=H.next(),Zv.CJ(12)}})},iw=function(M,f,A){var Q,N,Y,I,D,E,t;
return g.n(function(v){if(v.Z==1)return g.r(v,Gx(M,{mode:"readwrite",gq:!0},function(p){var h=kN(p,"transfer"),S=kN(p,"offlineOrchestrationActionWrapperEntity");return g.gX.all([h,S]).then(function(L){L=g.V(L);var a=L.next().value;var q=L.next().value;L=kY9.map(function(z){return B1e(p,z)});
q=g.V(q);for(var m=q.next();!m.done;m=q.next()){m=m.value;var R=g.M0(m.actionProto.entityKey).entityType==="musicTrack",u=m.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";os(f,m.actionProto)||R&&(!R||u)||L.push(X4(p,m.key,{EN:!0}))}return g.gX.all(L).then(function(){return a})})}),2);
Q=v.K;N=g.V(Q);for(Y=N.next();!Y.done;Y=N.next())I=Y.value,CC(I),D=g.M0(I.key).entityId,E={videoId:D,offlineDeleteReason:void 0,cotn:I.cotn},Er(E),t=g.fZ(D,"musicTrack"),Th(A,{entityKey:t,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.r(v,Bam(),0)})},WB9=function(M){for(var f,A=g.V(M.additionalMetadatas),Q=A.next();!Q.done;Q=A.next())Q=Q.value,Q.offlineMusicVideoData&&(f=Q.offlineMusicVideoData);
var N,Y,I,D,E;return{id:g.fZ(M.videoId,"musicTrack"),videoId:M.videoId,title:M.title,thumbnailDetails:M.thumbnail,lengthMs:String(Number(M.lengthSeconds)*1E3),albumTitle:(N=f)==null?void 0:N.releaseTitle,musicVideoType:(Y=f)==null?void 0:Y.musicVideoType,contentRating:{explicitType:(I=f)==null?void 0:I.explicitType},artistNames:((D=f)==null?void 0:D.byline)||((E=f)==null?void 0:E.channelName),downloadMetadata:g.fZ(M.videoId,"musicTrackDownloadMetadataEntity")}},bB6=function(M,f,A){var Q,N,Y,I,D,E,
t,v,p,h,S,L,a,q,m,R,u,z;
return g.n(function(e){Q=[];N=new Set;if((Y=A)==null?0:(I=Y.downloadedTracks)==null?0:I.length)for(D=g.V(A.downloadedTracks),E=D.next();!E.done;E=D.next())t=E.value,N.add(t);if(M.tracks){v=g.V(M.tracks);for(p=v.next();!p.done;p=v.next())h=p.value,N.has(h)||Q.push(h);S=g.V(f);for(L=S.next();!L.done;L=S.next())if(a=L.value,a.id!==M.id&&(q=a.tracks))for(m=g.V(q),R=m.next();!R.done;R=m.next())u=R.value,z=Q.indexOf(u),z!==-1&&Q.splice(z,1)}return e.return(Q)})},e26=function(M,f){var A,Q,N,Y,I,D,E,t;
return g.n(function(v){A=Ur(M.thumbnailDetails);Q=g.V(f);for(N=Q.next();!N.done;N=Q.next())if(Y=N.value,Y.id!==M.id)for(I=g.V(Ur(Y.thumbnailDetails)),D=I.next();!D.done;D=I.next())E=D.value,t=A.indexOf(E),t!==-1&&A.splice(t,1);return v.return(A)})},OBc=function(M,f){var A,Q,N,Y,I,D,E,t,v;
return g.n(function(p){if(p.Z==1)return A=g.fZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.r(p,lk(M,A,"musicDownloadsLibraryEntity"),2);(Q=p.K)||(Q={id:A});N=g.M0(f).entityType;N==="musicTrack"?(Y=Q.downloadedTracks)!=null&&Y.includes(f)||(Q.downloadedTracks=((I=Q.downloadedTracks)!=null?I:[]).concat(f)):N==="musicPlaylist"?(D=Q.downloadedPlaylists)!=null&&D.includes(f)||(Q.downloadedPlaylists=((E=Q.downloadedPlaylists)!=null?E:[]).concat(f)):N!=="musicAlbumRelease"||(t=Q.downloadedAlbumReleases)!=
null&&t.includes(f)||(Q.downloadedAlbumReleases=((v=Q.downloadedAlbumReleases)!=null?v:[]).concat(f));return g.r(p,wd(M,Q,"musicDownloadsLibraryEntity"),0)})},XiB=function(M,f){var A,Q,N,Y,I,D,E;
return g.n(function(t){if(t.Z==1)return A=g.fZ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.r(t,lk(M,A,"musicDownloadsLibraryEntity"),2);Q=t.K;if(!Q)return t.CJ(0);N=g.M0(f).entityType;N==="musicTrack"?Y=Q.downloadedTracks:N==="musicPlaylist"&&(Y=Q.downloadedPlaylists);if((I=Y)==null?0:I.length)for(D=0;D<Y.length;D++)if(E=Y[D],E===f){Y.splice(D,1);break}return g.r(t,wd(M,Q,"musicDownloadsLibraryEntity"),0)})},Jwm=function(M){var f=M.videos;
M=[];var A=[];if(f){f=g.V(f);for(var Q=f.next();!Q.done;Q=f.next()){var N=Q.value.offlineVideoData.videoId;Q=g.fZ(N,"musicTrack");N=g.fZ(N,"musicTrackDownloadMetadataEntity");M.push(Q);A.push(N)}}return{Nq:M,Gl:A}},xh=function(M,f,A){f={track:WB9(f)};
A&&(f.playlistId=A);if(M=g.b(M.actionMetadata,KBc))f.maximumDownloadQuality=M.maximumDownloadQuality;return{musicTrackEntityActionMetadata:f}},wie=function(M){var f,A,Q,N,Y,I,D,E;
return g.n(function(t){switch(t.Z){case 1:return f=g.D$(),A=KCv(M),Q=g.NO(GYv),g.HX(t,2),Y={n6:!0},g.r(t,g.GK(f,A,Q,void 0,Y),4);case 4:N=t.K;g.Rf(t,3);break;case 2:I=g.id(t);if(I instanceof g.Yu)throw D="GetOffline network manager error: "+I.message,Yh(D,I),Error(D);Yh("GetOffline fetch request error",I);throw Error("GetOffline fetch request error");case 3:E=ZW(N);if(!N)throw Yh("Network request failed"),Error("Network request failed");if(E!==void 0)rl(E);else if(!N.videos||!N.videos.length)throw Yh("No data"),
Error("No data");return t.return(N.videos.map(function(v){return v.offlineVideoData}))}})},lRR=function(M){var f,A,Q,N,Y,I,D,E;
return g.n(function(t){switch(t.Z){case 1:return f=g.D$(),A=Ggc(M),Q=g.NO(GYv),g.HX(t,2),Y={n6:!0},g.r(t,g.GK(f,A,Q,void 0,Y),4);case 4:N=t.K;g.Rf(t,3);break;case 2:I=g.id(t);if(I instanceof g.Yu)throw D="GetOffline network manager error for playlist: "+I.message,Yh(D,I),Error(D);Yh("GetOffline fetch request error for playlist",I);throw Error("GetOffline fetch request error for playlist");case 3:E=ZW(N);if(!N)throw Yh("Network request failed for playlist"),Error("Network request failed for playlist");
if(E!==void 0)rl(E,"playlist");else if(!N.playlists||!N.playlists.length)throw Yh("No data for playlist"),Error("No data for playlist");return t.return(N.playlists.map(function(v){return v.offlinePlaylistData}))}})},fIm=function(M,f,A,Q){var N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK;
return g.n(function(x9){switch(x9.Z){case 1:return g.r(x9,fC(),2);case 2:N=x9.K;if(!N)return x9.return([]);Y=[];if((I=Q)==null?0:I.length){Y=Q;x9.CJ(3);break}return g.r(x9,M$(N,"mainPlaylistEntity"),4);case 4:Y=x9.K;case 3:if(!Y.length)return x9.return([]);D=[];E=Date.now()/1E3;t=g.V(Y);v=t.next();case 5:if(v.done)return D.length?g.r(x9,MF6(D),10):x9.return([]);p=v.value;if(!p.downloadState){h=void 0;x9.CJ(8);break}return g.r(x9,lk(N,p.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:h=
x9.K;case 8:S=h;L=void 0;q=(a=(L=p)==null?void 0:L.entityMetadata)&&a.nextAutoRefreshIntervalSeconds?Number(a.nextAutoRefreshIntervalSeconds):NaN;m=Number.isNaN(q)?M:q;u=R=void 0;z=((R=S)==null?0:R.lastSyncedTimestampMillis)?Number((u=S)==null?void 0:u.lastSyncedTimestampMillis)/1E3:0;G=e=void 0;X=((e=S)==null?0:e.addedTimestampMillis)?Number((G=S)==null?void 0:G.addedTimestampMillis)/1E3:0;if(A||!a||z+m<=E){Qt=[];Y9=void 0;if((Y9=p.videos)==null?0:Y9.length)for(Mc=g.V(p.videos),E0=Mc.next();!E0.done;E0=
Mc.next())w=E0.value,m6=JSON.parse(g.M0(w).entityId),m6.videoId&&Qt.push(m6.videoId);BX="0";a&&(WX=void 0,BX=String(Number((WX=a.offlineLastModifiedTimestampSeconds)!=null?WX:0).toFixed()));g7={playlistId:p.playlistId,videoIds:Qt,offlineLastModifiedTimestamp:BX,autoSync:f,offlineDateAddedTimestamp:String(X.toFixed())};D.push(g7)}v=t.next();x9.CJ(5);break;case 10:return vK=x9.K,x9.return(vK)}})},ACw=function(){var M,f,A,Q,N;
return g.n(function(Y){if(Y.Z==1)return g.r(Y,fC(),2);if(Y.Z!=3)return(M=Y.K)?g.r(Y,M$(M,"refresh"),3):Y.return(!1);f=Y.K;if((A=f[0])==null||!A.refreshTime)return Y.return(!1);Q=Number(f[0].refreshTime);N=Date.now()/1E3;return Y.return(isFinite(Q)&&N>=Q)})},N8K=function(M,f){var A,Q,N;
return g.n(function(Y){switch(Y.Z){case 1:return g.HX(Y,2),g.r(Y,Qmc(M,f),4);case 4:return Q=Y.K,g.r(Y,PRC(Q),5);case 5:A=jcB(Q);g.Rf(Y,3);break;case 2:N=g.id(Y),Yh("getAndProcessSmartDownloadsResponse request or processing error",N);case 3:return Y.return(A)}})},YkW=function(M,f,A,Q){var N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK;
return g.n(function(x9){switch(x9.Z){case 1:return g.r(x9,fC(),2);case 2:N=x9.K;if(!N)return x9.return([]);Y=[];if((I=Q)==null?0:I.length){Y=Q;x9.CJ(3);break}return g.r(x9,M$(N,"musicPlaylist"),4);case 4:Y=x9.K;case 3:if(!Y.length)return x9.return([]);D=[];E=Date.now()/1E3;t=g.V(Y);v=t.next();case 5:if(v.done)return D.length?g.r(x9,MF6(D),10):x9.return([]);p=v.value;h=void 0;L=(S=(h=p)==null?void 0:h.entityMetadata)&&S.nextAutoRefreshIntervalSeconds?Number(S.nextAutoRefreshIntervalSeconds):NaN;a=
Number.isNaN(L)?M:L;m=q=0;R="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!p.downloadMetadata){x9.CJ(8);break}return g.r(x9,lk(N,p.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:u=x9.K,e=z=void 0,q=Number((e=(z=u)==null?void 0:z.addedTimestampMillis)!=null?e:"0")/1E3,X=G=void 0,m=Number((X=(G=u)==null?void 0:G.lastModifiedTimestampMillis)!=null?X:"0")/1E3,Y9=Qt=void 0,R=(Y9=(Qt=u)==null?void 0:Qt.syncState)!=null?Y9:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Mc=void 0;if(A||R!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!S||Number((Mc=S.lastSyncedTimestampSeconds)!=null?Mc:0)+a<=E){E0=[];w=void 0;if((w=p.tracks)==null?0:w.length)for(m6=g.V(p.tracks),BX=m6.next();!BX.done;BX=m6.next())WX=BX.value,E0.push(g.M0(WX).entityId);g7={playlistId:p.playlistId,videoIds:E0,offlineLastModifiedTimestamp:String(m.toFixed()),autoSync:f,offlineDateAddedTimestamp:String(q.toFixed())};D.push(g7)}v=t.next();x9.CJ(5);break;case 10:return vK=x9.K,x9.return(vK)}})},Qmc=function(M,f){var A,Q,N,Y,I,D,E,t,v,p;
return g.n(function(h){switch(h.Z){case 1:return A=g.D$(),g.r(h,fC(),2);case 2:Q=h.K;if(!Q){h.CJ(3);break}return g.r(h,NaC(Q),4);case 4:N=h.K;case 3:var S=N;Y={context:g.fp(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:M},offlineClientState:S,clientStateRequestData:{preferredFormatType:f}}}};I=g.NO(IIC);g.HX(h,5);E={n6:!0};return g.r(h,g.GK(A,Y,I,void 0,E),7);case 7:D=h.K;g.Rf(h,6);break;case 5:t=g.id(h);if(t instanceof g.Yu)throw v=
"DPS network manager error for smart downloads: "+t.message,Yh(v,t),Error(v);Yh("DPS fetch request error for smart downloads",t);throw Error("DPS fetch request error for smart downloads");case 6:p=ZW(D);if(D)p!==void 0&&rl(p,"smart downloads");else throw Yh("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return h.return(D)}})},Ds9=function(M,f){var A,Q,N,Y,I,D,E,t;
return g.n(function(v){switch(v.Z){case 1:return A=g.D$(),Q={context:g.fp(),videoPlaybackPositionEntities:M,lastSyncTimestampUsec:f},N=g.NO(T80),g.HX(v,2),I={n6:!0},g.r(v,g.GK(A,Q,N,void 0,I),4);case 4:Y=v.K;g.Rf(v,3);break;case 2:D=g.id(v);if(D instanceof g.Yu)throw E="VPPS network manager error: "+D.message,Yh(E,D),Error(E);Yh("VPPS fetch request error",D);throw Error("VPPS fetch request error");case 3:t=ZW(Y);if(Y)t!==void 0&&rl(t,"position sync");else throw Yh("Network request failed for position sync"),
Error("Network request failed for position sync");return v.return(Y)}})},tF6=function(M,f,A){var Q,N,Y,I,D,E,t,v;
return g.n(function(p){switch(p.Z){case 1:Q=g.D$();var h=A.refreshData,S=A.isEnqueuedForExpiredStreamUrlRefetch,L=A.t_,a=A.offlineSourceData,q=A.mediaCapabilities,m={entityKey:M};h&&(m.refreshData=h);S&&(m.isExpiredStreamUrlRefetch=S);L&&(m.downloadParameters=L);a&&(m.offlineSourceData=a);h={context:g.NZ(f),signatureTimestamp:20220,videos:[m]};q&&(h.mediaCapabilities=q);N=h;Y=g.NO(E6B);g.HX(p,2);D={n6:!0};return g.r(p,g.GK(Q,N,Y,void 0,D),4);case 4:I=p.K;g.Rf(p,3);break;case 2:E=g.id(p);if(E instanceof
g.Yu)throw t="GetPDE network manager error: "+E.message,Yh(t,E),Error(t);Yh("GetPDE fetch request error",E);throw Error("GetPDE fetch request error");case 3:v=ZW(I);if(I)v!==void 0&&rl(v,"PDE");else throw Yh("Network request failed for PDE"),Error("Network request failed for PDE");return p.return(I)}})},ZW=function(M){var f;
return(f=M.errorMetadata)==null?void 0:f.status},rl=function(M,f){f=f?" for "+f:"";
if(M===0)throw M="Empty response body"+f,Yh(M),Error(M);M="Response with error"+f;Yh(M);throw Error(M);},MF6=function(M){var f,A,Q,N,Y,I,D,E;
return g.n(function(t){switch(t.Z){case 1:return f=g.D$(),A=wW9(M),Q=g.NO(v6W),g.HX(t,2),Y={n6:!0},g.r(t,g.GK(f,A,Q,void 0,Y),4);case 4:N=t.K;g.Rf(t,3);break;case 2:I=g.id(t);if(I instanceof g.Yu)throw D="offlinePlaylistSyncCheck network manager error: "+I.message,Yh(D,I),Error(D);Yh("offlinePlaylistSyncCheck fetch request error",I);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:E=ZW(N);if(!N)throw Yh("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(E!==void 0)rl(E,"playlist sync");else if(!N.offlinePlaylistSyncCheckDatas||!N.offlinePlaylistSyncCheckDatas.length)throw Yh("No data for playlist sync"),Error("No data for playlist sync");return t.return(N.offlinePlaylistSyncCheckDatas.map(function(v){return v.offlinePlaylistSyncCheckData}))}})},uw=function(M){this.K=M},pL9=function(M,f){var A,Q,N,Y,I,D;
return g.n(function(E){switch(E.Z){case 1:A=new Map,Q=g.V(f),N=Q.next();case 2:if(N.done){E.CJ(4);break}Y=N.value;I=A;D=I.set;return g.r(E,M.Z(Y),5);case 5:D.call(I,Y,E.K);N=Q.next();E.CJ(2);break;case 4:return E.return(A)}})},zh=function(M,f,A,Q,N,Y){f=g.fZ(f,A);
Q=Object.assign({},Y,{priority:Q,retryScheduleIntervalsInSeconds:N});return{actionType:M,entityKey:f,actionMetadata:Q}},P0=function(M,f,A,Q,N,Y){this.status=M;
this.K=f;this.C=A;this.Z=Q;this.j=N;this.downloadState=Y},hhC=function(M,f,A){this.K=M;
this.QY=f;this.j=A},o6B=function(M,f){var A,Q,N,Y,I,D,E,t,v;
return g.n(function(p){switch(p.Z){case 1:return A=f.entityKey,N=(Q=g.b(f.actionMetadata,nC))==null?void 0:Q.isEnqueuedForExpiredStreamUrlRefetch,g.HX(p,2),Y=void 0,g.r(p,Skm(M,f),4);case 4:Y=p.K;g.HX(p,5);var h=(h=g.b(f.actionMetadata,nC))?{maximumDownloadQuality:h.maximumDownloadQuality}:void 0;return g.r(p,tF6(A,M.QY,{isEnqueuedForExpiredStreamUrlRefetch:N,t_:h,offlineSourceData:Y}),7);case 7:I=p.K;g.Rf(p,6,2);break;case 5:return g.id(p,2),D=v0(f)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Yh("PDE handleAdd error"),p.return(j6(f,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,"DOWNLOAD_STATE_FAILED"));case 6:return g.r(p,Lew(M,I,f),8);case 8:return p.return(j6(f,!0,I.orchestrationActions));case 2:return E=g.id(p),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.au&&E.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Yh("PDE handleAdd error"),p.return(j6(f,!1,void 0,t,v,"DOWNLOAD_STATE_FAILED"))}})},VFW=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9;
return g.n(function(Mc){switch(Mc.Z){case 1:return A=f.entityKey,Q=g.M0(A).entityId,g.r(Mc,Gx(M.K,{mode:"readonly",gq:!0},function(E0){var w=bk(E0,A,"playbackData"),m6=bk(E0,g.fZ(Q,"offlineVideoPolicy"),"offlineVideoPolicy");E0=bk(E0,g.fZ(Q,"transfer"),"transfer");return g.gX.all([w,m6,E0])}),2);
case 2:N=Mc.K;Y=g.V(N);I=Y.next().value;D=Y.next().value;E=Y.next().value;t=I;v=D;p=E;if(!t||!v)return Mc.return(j6(f,!0));h=[];a=((L=t)==null?0:L.playerResponseJson)?JSON.parse(t.playerResponseJson):null;if(!(p&&a&&M.QY.V("html5_refresh_deprecated_downloads"))){Mc.CJ(3);break}S=Caw(M,a,p);return g.r(Mc,UsW(M,p),4);case 4:h=Mc.K;case 3:q={lastPlayerResponseTimestampSeconds:t.playerResponseTimestamp,offlineToken:v.offlineToken,formatIds:h};m={};if((R=p)==null?0:R.maximumDownloadQuality)m.maximumDownloadQuality=
p.maximumDownloadQuality;g.HX(Mc,5);u=void 0;return g.r(Mc,Skm(M,f),7);case 7:return u=Mc.K,g.HX(Mc,8),g.r(Mc,tF6(A,M.QY,{refreshData:q,t_:m,offlineSourceData:u,mediaCapabilities:S}),10);case 10:z=Mc.K;g.Rf(Mc,9,5);break;case 8:return g.id(Mc,5),e=v0(f)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Yh("PDE handleRefresh error"),Mc.return(j6(f,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",e,
"DOWNLOAD_STATE_FAILED"));case 9:return g.r(Mc,Lew(M,z,f),11);case 11:return Mc.return(j6(f,!0,z.orchestrationActions));case 5:return G=g.id(Mc),X="PDE handleRefresh error",G instanceof Error&&(X="PDE handleRefresh error: "+G.message),Qt="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y9="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.au&&G.type==="QUOTA_EXCEEDED"&&(Qt="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y9="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Yh(X),Mc.return(j6(f,!1,void 0,Qt,Y9,"DOWNLOAD_STATE_FAILED"))}})},Skm=function(M,f){var A,Q,N,Y;
return g.n(function(I){if(I.Z==1)return A=g.M0(f.entityKey).entityId,Q=g.fZ(A,"videoDownloadContextEntity"),g.r(I,lk(M.K,Q,"videoDownloadContextEntity"),2);N=I.K;return(Y=N)!=null&&Y.offlineModeType?I.return({offlineModeType:N.offlineModeType}):I.return(void 0)})},Lew=function(M,f,A){var Q,N,Y,I,D;
return g.n(function(E){if(E.Z==1){if(!f.frameworkUpdates||!g.b(f.frameworkUpdates,c0))return E.return();if(!(g.b(f.frameworkUpdates,c0).mutations&&g.b(f.frameworkUpdates,c0).mutations.length>0&&g.b(f.frameworkUpdates,c0).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return E.CJ(2);Q=g.M0(g.b(f.frameworkUpdates,c0).mutations[0].entityKey).entityId;return g.r(E,Rs(M.K,Q),3)}if(E.Z!=2){N=E.K;Y=g.b(A.actionMetadata,nC);if(D=(I=Y)==null?void 0:I.playlistId)N.playlistId=D;N.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Q5(M.QY)?g.r(E,sr(Q,M.K,A,M.j,N),2):g.dA(M.QY)?g.r(E,gl(Q,M.K,A,M.j),2):E.CJ(2)}return g.r(E,d76(g.b(f.frameworkUpdates,c0)),0)})},j6=function(M,f,A,Q,N,Y){return new P0(f?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v0(M),A,Q,N,Y)},Caw=function(M,f,A){f=R2B(M.QY,A.cotn,f);
A=g.hg(f);return g.AxN(f,A,M.QY)},UsW=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h;
return g.n(function(S){if(S.Z==1)return A=[],g.r(S,Gx(M.K,{mode:"readonly",gq:!0},function(L){var a=[],q=f.offlineVideoStreams;if(q){q=g.V(q);for(var m=q.next();!m.done;m=q.next())a.push(bk(L,m.value,"offlineVideoStreams"))}return g.gX.all(a)}),2);
if(Q=S.K)for(N=g.V(Q),Y=N.next();!Y.done;Y=N.next())if(I=Y.value,D=void 0,(D=I)==null?0:D.streamsProgress)for(E=I.streamsProgress,t=0;t<E.length;t++)v=E[t],p=JSON.parse(v.formatStreamBytes),h={itag:p.itag,lmt:p.lastModified,xtags:p.xtags},A.push(h);return S.return(A)})},aIK=function(M,f){this.K=M;
this.QY=f},qk7=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S;
return g.n(function(L){switch(L.Z){case 1:return A=v0(f),g.r(L,M$(M.K,"videoPlaybackPositionEntity"),2);case 2:Q=L.K;if(Q.length===0)return L.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));g.HX(L,3);return g.r(L,yg.getInstance(),5);case 5:N=L.K;if(!N)throw Error("prefStorage is undefined");return g.r(L,N.get("psi"),6);case 6:return Y=L.K,E=(D=(I=Y)==null?void 0:I.oM)!=null?D:"0",g.r(L,Ds9(Q,E),7);case 7:return t=L.K,v={isPaused:t.watchHistoryPaused,oM:t.syncTimestampUsec},g.r(L,N.set("psi",
v),8);case 8:if(v.isPaused){L.CJ(9);break}p=g.b(t.frameworkUpdates,c0);if(!t.frameworkUpdates||!p){L.CJ(9);break}return g.r(L,d76(p),9);case 9:g.Rf(L,4);break;case 3:return h=g.id(L),S="PPE handleRefresh error: "+(h instanceof Error?h.message:"unknown error"),Yh(S),L.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return L.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A))}})},msK=function(M,f){var A,Q,N,Y,I,D,E,t;
return g.n(function(v){switch(v.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey).entityId,g.HX(v,2),g.r(v,yg.getInstance(),4);case 4:N=v.K;if(!N)throw Error("prefStorage is undefined");return g.r(v,N.get("psi"),5);case 5:Y=v.K;I=g.b(f.actionMetadata,HlR);if(((D=Y)==null?void 0:D.isPaused)!==!1||(E=I)==null||!E.lastPlaybackPositionSeconds){v.CJ(6);break}t={key:g.fZ(Q,"videoPlaybackPositionEntity"),videoId:Q,lastPlaybackPositionSeconds:I.lastPlaybackPositionSeconds};return g.r(v,wd(M.K,t,"videoPlaybackPositionEntity"),
6);case 6:g.Rf(v,3);break;case 2:return g.id(v),v.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A))}})},sm6=function(M,f){var A,Q,N;
return g.n(function(Y){switch(Y.Z){case 1:A=v0(f);g.HX(Y,2);Q=g.M0(f.entityKey).entityId;if(Q==="!*$_ALL_ENTITIES_!*$")return g.r(Y,nMB(M.K),5);N=g.fZ(Q,"videoPlaybackPositionEntity");return g.r(Y,P4c(M.K,N),5);case 5:g.Rf(Y,3);break;case 2:return g.id(Y),Y.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A))}})},cCW=function(M,f){this.api=M;
this.K=f;this.logger=new g.tD("woffle");this.Z=!1;this.Ed={Dq:this.Dq};this.logger.debug("Initialized OfflineMediaManager")},Rhc=function(M){return g.n(function(f){return f.return(J_e(M))})},g6w=function(M){var f;
return g.n(function(A){if(A.Z==1)return g.r(A,g.mHU(M),2);f=A.K;return A.return(f.filter(function(Q){return!!Q.url}).map(function(Q){return Q.url}))})},$h=function(M,f){var A=g.nF(f);
if(A===1||A===0)return Promise.resolve();(A=B8m(M,f))&&A.stopVideo();M.j=0;return Rhc(f)},Fp=function(M,f,A,Q){A=A===void 0?!1:A;
Q=Q===void 0?!0:Q;var N=typeof f==="string"?f:f.videoDetails.videoId;g.nF(N)===2&&((f=B8m(M,N))?f.stopVideo():M.logger.info(function(){return"Corresponding player for "+N+" not found. Pausing anyway"}),g.jH(N,2),M.j=2,A?ilB(M.K):Q&&xs0(M.K))},B8m=function(M,f){var A;
return((A=M.player)==null?void 0:A.getVideoData().videoId)===f?M.player:null},ZlB=function(M,f,A){f.getPlayerResponse();
g.jH(f.videoId,2);M.j=2;M.Z=!1;var Q;(Q=M.player)==null||Q.dispose();M.player=M.api.xj(f);f={};M.player.LI((f.localmediachange=M.L7,f.signatureexpired=M.Ac,f.statechange=M.uC$,f),M);var N=M.Dq(A);M.player.kJ(g.or(N,N,!0,"m"),!1);M.logger.debug(function(){return"Starting headless playback with quality: "+N});
M.player.Vt(!1)},rCW=function(M,f){this.K=M;
this.QY=f},zhB=function(M,f){var A,Q;
return g.n(function(N){switch(N.Z){case 1:return A=v0(f),g.r(N,lk(M.K,f.entityKey,"transfer"),2);case 2:if(Q=N.K)return N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));g.HX(N,3);return g.r(N,uym(M,f),5);case 5:g.Rf(N,4);break;case 3:return g.id(N),N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A))}})},Pa6=function(M,f){var A,Q;
return g.n(function(N){switch(N.Z){case 1:return A=v0(f),g.r(N,lk(M.K,f.entityKey,"transfer"),2);case 2:Q=N.K;if(!Q||Q.transferState!=="TRANSFER_STATE_COMPLETE")return N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));g.HX(N,3);return g.r(N,uym(M,f,!0),5);case 5:g.Rf(N,4);break;case 3:return g.id(N),N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A))}})},n60=function(M,f){var A,Q,N,Y,I,D,E,t,v,p;
return g.n(function(h){switch(h.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey).entityId,g.r(h,Gx(M.K,{mode:"readonly",gq:!0},function(S){var L=bk(S,f.entityKey,"transfer");S=bk(S,g.fZ(Q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.gX.all([L,S])}),2);
case 2:N=h.K;Y=g.V(N);I=Y.next().value;D=Y.next().value;E=I;t=D;if(!E||E.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return h.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));g.HX(h,3);E.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.r(h,wd(M.K,E,"transfer"),5);case 5:v=g.M0(E.key).entityId;aRW({videoId:v,BB:E,offlineModeType:(p=t)==null?void 0:p.offlineModeType});g.Rf(h,4);break;case 3:return g.id(h),h.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return h.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A))}})},uym=function(M,f,A){A=A===void 0?!1:A;
var Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m;return g.n(function(R){switch(R.Z){case 1:return Q=g.b(f.actionMetadata,jm0),N=g.M0(f.entityKey).entityId,Y=g.fZ(N,"downloadStatusEntity"),g.r(R,Gx(M.K,{mode:"readonly",gq:!0},function(u){var z=bk(u,Y,"downloadStatusEntity");u=bk(u,g.fZ(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.gX.all([z,u])}),2);
case 2:return I=R.K,D=g.V(I),E=D.next().value,t=D.next().value,v=E,p=t,h="TRANSFER_STATE_TRANSFER_IN_QUEUE",((S=v)==null?void 0:S.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(h="TRANSFER_STATE_PAUSED_BY_USER"),q={key:f.entityKey,transferState:h,cotn:g.RP(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(L=Q)==null?void 0:L.maximumDownloadQuality,preferredAudioTrack:(a=Q)==null?void 0:a.preferredAudioTrack,transferRetryCount:0,isRefresh:A,hasLoggedFirstStarted:!1},g.r(R,Gx(M.K,
{mode:"readwrite",gq:!0},function(u){var z=[];A&&z.push(X4(u,g.fZ(N,"offlineVideoStreams")));z.push(O4(u,q,"transfer"));return g.gX.all(z)}),3);
case 3:if(!A){R.CJ(4);break}return g.r(R,Rhc(N),4);case 4:UlR({videoId:N,BB:q,offlineModeType:(m=p)==null?void 0:m.offlineModeType}),g.qc(R)}})},Fe6=function(M,f,A,Q){if(!M.action.entityKey)throw Error("entityKey is missing.");
var N=g.M0(M.action.entityKey);N={entityType:N.yX,entityId:N.entityId,offlineOrchestrationActionType:M.action.actionType,orchestrationAction:{orchestrationActionId:M.actionId}};f&&(N.offlineOrchestrationActionResult=f.status,N.isRetryable=A?!1:f.K,f.j&&(N.offlineOrchestrationFailureReason=$sR(f.j,N.isRetryable)));var Y,I;if((Y=M.action.actionMetadata)==null?0:(I=Y.offlineLoggingData)==null?0:I.offlineModeType)N.offlineModeType=M.action.actionMetadata.offlineLoggingData.offlineModeType;Q&&(N.additionalOrchestrationActions=
Q.map(function(D){return{orchestrationActionId:D.actionId}}));
return N},$sR=function(M,f){return M!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||f?M==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&f?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":M:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},yC0=function(M,f){var A={offlineOrchestrationContext:Fe6(M)};
f=Aww(f,A);QcC(fRe(),f,M.rootActionId)},ds9=function(M,f,A,Q){Q=Q===void 0?[]:Q;
f={offlineOrchestrationContext:Fe6(M,f,A,Q)};f=Aww(3,f);QcC(fRe(),f,M.rootActionId)},ehm=function(){this.actions=[]},blK=function(M,f){f=g.V(f);
for(var A=f.next();!A.done;A=f.next())A=A.value,yC0(A,1),M.actions.push(A);M.actions.sort(M.K)},k37=function(M,f){if(f)for(var A=0;A<M.actions.length;A++)if(f==="!*$_ALL_ENTITIES_!*$"&&M.actions[A].actionId!==f||f!=="!*$_ALL_ENTITIES_!*$"&&M.actions[A].rootActionId===f&&M.actions[A].actionId!==f)M.actions.splice(A,1),A--},Wev=function(M,f){M=g.V(M.actions);
for(var A=M.next();!A.done;A=M.next())if(A.value.actionId===f)return!0;return!1},yD=function(M,f,A,Q,N){g.y.call(this);
var Y=this;this.Z=M;this.jk=f;this.Er=A;this.W=Q;this.QY=N;this.K=new ehm;this.G=new g.G8;this.j=new g.MY(function(){Y.retry()});
this.X=NaN;this.N=!1;this.Ed={Z6Y:function(){return Y.K},
HR:function(){return Y.G},
js7:function(){return Y.j},
retry:function(){return Y.retry()}};
g.d(this,this.j);this.B=this.Z.observe(this.KJ.bind(this))},JC0=function(M,f,A,Q,N){var Y;
return g.n(function(I){if(I.Z==1)return Y=new yD(M,f,A,Q,N),g.r(I,Olc(Y),2);XLW(Y);return I.return(Y)})},XLW=function(M){var f=M.K.actions[0];
return M.C?((f==null?void 0:f.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&M.C[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(M.N=!0),Promise.resolve()):KeR(M)},KeR=function(M){var f,A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m;
return g.n(function(R){switch(R.Z){case 1:if(M.C)throw Error("Already processing an action");if(M.ek())return R.return();f=M.K.actions.shift();oWe(M.Er,!f);if(f===void 0)return R.return();f.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&f.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&k37(M.K,f.actionId);A="";f.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&f.rootActionId===f.actionId&&(A=f.actionId);Q=[f];M.C=Q;if(N=M.jk[f.entityType]){R.CJ(2);break}M.C=
void 0;return g.r(R,KeR(M),3);case 3:return R.return();case 2:Y=g.V(Q);for(I=Y.next();!I.done;I=Y.next())D=I.value,yC0(D,2);g.HX(R,4,5);return g.r(R,pL9(N,Q.map(function(u){return u.action})),7);
case 7:E=R.K,t=g.V(Q),v=t.next();case 8:if(v.done){R.CJ(10);break}p=v.value;h=E.get(p.action);return g.r(R,G3R(M,p,h),9);case 9:v=t.next();R.CJ(8);break;case 10:k37(M.K,A);case 5:g.ZU(R);M.C=void 0;g.ud(R,6);break;case 4:return S=g.id(R),Yh("Orchestration error",S),g.HX(R,12),g.r(R,wLw(M,Q),14);case 14:g.Rf(R,5);break;case 12:L=g.id(R);Yh("Orchestration retry error",L);a=g.V(Q);for(q=a.next();!q.done;q=a.next())m=q.value,m.retryScheduleIndex<3&&blK(M.K,[m]);R.CJ(5);break;case 6:return g.r(R,KeR(M),
0)}})},G3R=function(M,f,A){var Q,N,Y,I,D,E,t,v,p,h,S,L;
return g.n(function(a){switch(a.Z){case 1:Q=f.retryScheduleIndex+2===3;if(A.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){a.CJ(2);break}if(A.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){a.CJ(0);break}ds9(f,A,Q);if(A.K&&f.retryScheduleIndex+1<3)return g.r(a,wLw(M,[f]),0);Y=((N=A)==null?0:N.Z)?A.Z:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";I={entityKey:f.action.entityKey,failureReason:Y};D=void 0;g.Q5(M.QY)?D="mainVideoDownloadStateEntity":g.dA(M.QY)&&(D="musicTrackDownloadMetadataEntity");
if(!D||!A.downloadState){a.CJ(7);break}E=g.M0(f.action.entityKey).entityId;return g.r(a,LC(E,D,M.Z,A.downloadState),7);case 7:Th(M.W,I);if(A.downloadState==="DOWNLOAD_STATE_FAILED"&&M.QY.V("html5_auto_retry_failed_pde_actions")){a.CJ(0);break}Yh("Orchestration result is not retryable, deleting action");return g.r(a,P4c(M.Z,q$(f).key),0);case 2:t=void 0;try{t=(v=A.C)==null?void 0:v.map(function(q){return M.createAction(q,f)})}catch(q){return ds9(f,A,Q),p={entityKey:f.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Th(M.W,p),Yh("Orchestration subactions creation error",q),a.return()}ds9(f,A,Q,t);if(!t){a.CJ(12);break}h=t.map(function(q){return q$(q)});
S=0;case 13:if(!(S<t.length)||M.N){a.CJ(15);break}return g.r(a,Gx(M.Z,{mode:"readwrite",gq:!0},function(q){var m=[];m.push(c_K(q,h.slice(S,S+10),"offlineOrchestrationActionWrapperEntity"));return g.gX.all(m)}),16);
case 16:S+=10;a.CJ(13);break;case 15:if(M.N)return M.N=!1,a.return();case 12:return L=q$(f),g.r(a,P4c(M.Z,L.key),17);case 17:yC0(f,4),g.qc(a)}})},AZK=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S;
return g.n(function(L){A=[];Q=Infinity;N=4E3;Y=g.V(f);for(I=Y.next();!I.done;I=Y.next())D=I.value,E=Number(D.enqueueTimeSec),t=lIC(E),v=D.retryScheduleIndex,p=v!=null&&v>0,t>0&&p?(Q=Math.min(Q,E),N=Math.min(t,N)):A.push(D);isFinite(Q)&&(!M.j.isActive()||Q<M.X)&&(M.X=Q,M.j.start(N));M.G.Ag()||(h=A.length,A=A.filter(function(a){var q;a=((q=a.actionProto)==null?void 0:q.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Mbw.includes(a)}),S=A.length<h,!M.j.isActive()&&S&&M.j.start(1));
A.length>0&&fgK(M,A);return g.r(L,XLW(M),0)})},NPe=function(M){var f,A,Q,N,Y,I,D;
return g.n(function(E){if(E.Z==1)return g.r(E,QAw(M),2);f=E.K;A=[];Q=g.V(f);for(N=Q.next();!N.done;N=Q.next())Y=N.value,I=g.M0(Y.key),D=I.entityId,Wev(M.K,D)||A.push(Y);return g.r(E,AZK(M,A),0)})},lIC=function(M){M=M*1E3-Date.now();
return M>4E3?4E3:M},wLw=function(M,f){var A,Q,N;
return g.n(function(Y){A=g.V(f);for(Q=A.next();!Q.done;Q=A.next()){N=Q.value;var I=void 0,D=void 0,E=((D=N.action)==null?void 0:(I=D.actionMetadata)==null?void 0:I.retryScheduleIntervalsInSeconds)||[1,2,4];I=1;N.retryScheduleIndex<E.length&&(I=E[N.retryScheduleIndex]);N.K=I*1E3+Date.now();N.retryScheduleIndex++}return g.r(Y,YDK(M,f),0)})},Olc=function(M){var f;
return g.n(function(A){if(A.Z==1)return g.r(A,M$(M.Z,"offlineOrchestrationActionWrapperEntity"),2);f=A.K;return g.r(A,AZK(M,f),0)})},fgK=function(M,f){f.length!==0&&f.forEach(function(A){A=as(A);
A.retryScheduleIndex<3&&blK(M.K,[A])})},QAw=function(M,f){var A;
return g.n(function(Q){if(Q.Z==1)return g.r(Q,M$(M.Z,"offlineOrchestrationActionWrapperEntity",f),2);A=Q.K;return Q.return(A.filter(egv))})},YDK=function(M,f){if(f.length===0)return Promise.resolve([]);
f=f.map(function(A){return q$(A)});
return zge(M.Z,f)},Igv=function(M){this.G0=M;
this.K=void 0},TPw=function(M,f){var A,Q,N,Y;
return g.n(function(I){A=f.videoId;Q=!0;if(f.captionTracks.length)N=qYW(f),M.K=new g.aW(M.G0,f,N);else if(f.gb)Y=g.zjU(f),M.K=new g.Ht(M.G0,f.gb,A,Y,f.s5,f.eventId),Q=f.s5;else return I.return();return I.return(new Promise(function(D){var E;(E=M.K)==null||E.Z6({T7:function(){return g.n(function(t){if(t.Z==1)return g.r(t,M.T7(A,Q),2);D();g.qc(t)})},
c5:function(){}})}))})},DY7=function(M){var f;
return g.n(function(A){if(A.Z==1)return g.r(A,XW9(M),2);f=A.K;return A.return(!!f&&f.length>0)})},dl=function(M){g.y.call(this);
this.K=M;this.Z=this.K.observe(this.j.bind(this))},E2w=function(M,f){var A,Q,N,Y,I,D,E;
return g.n(function(t){switch(t.Z){case 1:if(f.length===0)return t.return([]);A=f.map(function(v){return g.fZ(v,"transfer")});
return g.r(t,M$(M.K,"transfer",A),2);case 2:Q=t.K;N=Q.filter(egv).map(function(v){return g.M0(v.key).entityId});
Y=f.filter(function(v){return N.indexOf(v)===-1});
if(Y.length===0)return t.return([]);I=g.V(Y);D=I.next();case 3:if(D.done){t.CJ(5);break}E=D.value;return g.r(t,Rhc(E),4);case 4:D=I.next();t.CJ(3);break;case 5:return t.return(Y)}})},pvm=function(M,f,A,Q,N,Y){var I,D,E;
return g.n(function(t){I="STREAM_TYPE_UNKNOWN";A.video&&A.audio?(I="STREAM_TYPE_AUDIO_AND_VIDEO",Yh("unexpected stream type")):A.video&&!A.audio?I="STREAM_TYPE_VIDEO":!A.video&&A.audio&&(I="STREAM_TYPE_AUDIO");D=g.fZ(f,"offlineVideoStreams");E={numBytesDownloaded:N.toFixed(),numTotalBytes:Y.toFixed(),streamType:I,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(Q),itag:I==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(A.itag):void 0};return g.r(t,Gx(M,{mode:"readwrite",gq:!0},
function(v){var p=bk(v,D,"offlineVideoStreams"),h=bk(v,g.fZ(f,"transfer"),"transfer");return g.gX.all([p,h]).then(function(S){S=g.V(S);var L=S.next().value;S=S.next().value;if(!S)return X4(v,D).then(function(){});
var a=tbK(L);L=v2R(L,Q,E,D);var q=O4(v,L,"offlineVideoStreams");tbK(L)>a&&(S.lastProgressTimeMs=Date.now().toString());a=[q];S.offlineVideoStreams||(S.offlineVideoStreams=[]);S.offlineVideoStreams.indexOf(D)===-1&&(S.offlineVideoStreams.push(D),a.push(O4(v,S,"transfer")));return g.gX.all(a)})}),0)})},hmW=function(M,f){var A,Q,N,Y,I;
return g.n(function(D){if(D.Z==1)return A=g.fZ(f,"offlineVideoStreams"),g.r(D,lk(M,A,"offlineVideoStreams"),2);Q=D.K;if(!Q||!Q.streamsProgress)return D.return();N=g.V(Q.streamsProgress);for(Y=N.next();!Y.done;Y=N.next())I=Y.value,I.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",I.numTotalBytes!==I.numBytesDownloaded&&(I.numBytesDownloaded=I.numTotalBytes);return g.r(D,wd(M,Q,"offlineVideoStreams"),0)})},v2R=function(M,f,A,Q){if(M&&M.streamsProgress){Q=M;
a:{f=f.itag+";"+f.xtags;for(var N=M.streamsProgress,Y=0;Y<N.length;Y++){var I=JSON.parse(N[Y].formatStreamBytes);if(I.itag+";"+I.xtags===f){N[Y]=A;A=N;break a}}N.push(A);A=N}Q.streamsProgress=A}else M={key:Q,streamsProgress:[A]};return M},tbK=function(M){if(M==null?0:M.streamsProgress){var f=0;
M=M.streamsProgress;for(var A=0;A<M.length;A++){var Q=M[A];isNaN(Number(Q.numBytesDownloaded))?Yh("stream progress bytes number invalid"):f+=Number(Q.numBytesDownloaded)}return f}return 0},SDW=function(M,f,A,Q){g.y.call(this);
var N=this;this.Z=M;this.api=f;this.ox=A;this.KJ=Q;this.G=new g.G8;this.C=new g.MY(function(){N.K&&N.K.transferState==="TRANSFER_STATE_TRANSFERRING"&&N.G.Ag()&&((N.K.transferRetryCount||0)<3?Fp(N.W,N.N,!1,!1):$h(N.W,N.N.videoDetails.videoId),N.Wp("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Er=this.z0=0;this.B=this.X=!1;this.YO=g.CE(this.api.T().experiments,"html5_transfer_processing_logs_interval");this.nJ=new g.yK(this);this.Ed={fuO:function(){return N.C},
FJr:function(){return N.KJ},
HR:function(){return N.G}};
this.jk=this.Z.observe(this.Ge.bind(this));this.W=new cCW(f,this);this.Ji=new Igv(f);this.P7=new dl(this.Z);this.fJ=this.G.listen("publicytnetworkstatus-online",this.b6.bind(this));this.g_=this.G.listen("publicytnetworkstatus-offline",this.vz8.bind(this));this.B=this.api.T().V("html5_less_transfer_processing_logs");g.d(this,this.nJ);this.nJ.J(f,"offlinetransferpause",this.wu8);g.Q5(this.api.T())?this.j="mainVideoDownloadStateEntity":g.dA(this.api.T())&&(this.j="musicTrackDownloadMetadataEntity")},
Ls0=function(M){return g.n(function(f){if(f.Z==1)f=g.r(f,WCv(),2);
else{var A=M.P7;var Q=g.P5();Q=Object.keys(Q);A=E2w(A,Q);f=g.r(f,A,0)}return f})},bw=function(M,f){f=f===void 0?!1:f;
var A;return g.n(function(Q){if(Q.Z==1){if(M.K)throw Error("Already downloading a video");M.Er=0;M.X=!1;return g.r(Q,o29(M),2)}return Q.Z!=4?(A=Q.K,CRB(M.ox,!A),A&&M.G.Ag()?f?g.r(Q,new Promise(function(N){g.Uf(N,1E3)}),4):Q.CJ(4):(!A&&M.K&&e6(M),Q.CJ(0))):g.r(Q,CrC(M,A),0)})},UY0=function(M){return g.n(function(f){if(f.Z==1)return M.N?g.r(f,$h(M.W,M.N.videoDetails.videoId),3):f.CJ(0);
e6(M);g.qc(f)})},Vb0=function(M,f){var A,Q,N;
return g.n(function(Y){switch(Y.Z){case 1:return g.HX(Y,2),(A=!!f.captionTracks.length||!!f.gb)?g.r(Y,DY7(f.videoId),4):Y.return();case 4:return(Q=Y.K)?Y.return():g.r(Y,TPw(M.Ji,f),5);case 5:g.Rf(Y,0);break;case 2:N=g.id(Y),Yh("Caption downloading error",N,f.cotn),g.qc(Y)}})},CrC=function(M,f){var A,Q,N,Y,I,D;
return g.n(function(E){switch(E.Z){case 1:if(M.X)return E.return();M.X=!0;M.K=f;A=g.M0(M.K.key);Q=A.entityId;N=void 0;if(M.K.transferState==="TRANSFER_STATE_TRANSFERRING")return g.r(E,kh(M,Q),7);if(M.K.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||M.K.transferRetryCount||M.K.hasLoggedFirstStarted){E.CJ(3);break}return g.r(E,kh(M,Q),5);case 5:return N=E.K,M.K.hasLoggedFirstStarted=!0,g.r(E,age(M),6);case 6:VM6({videoId:Q,BB:M.K,offlineModeType:N},void 0,void 0,!0);E.CJ(3);break;case 7:N=E.K,
ti({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:Q,BB:M.K,offlineModeType:N});case 3:return g.r(E,qDW(M),8);case 8:return Y=null,g.HX(E,9),g.r(E,H56(M,f),11);case 11:Y=E.K;M.N=Y;g.Rf(E,10);break;case 9:return I=g.id(E),Yh("error getting player response",I,f.cotn),g.r(E,M.Wp("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return E.return();case 10:return D=R2B(M.api.T(),f.cotn,Y),g.r(E,Vb0(M,D),13);case 13:return g.r(E,g6w(D.videoId),
14);case 14:D.h5=E.K,ZlB(M.W,D,f.maximumDownloadQuality),M.C.start(108E5),g.qc(E)}})},o29=function(M){var f,A;
return g.n(function(Q){if(Q.Z==1)return g.r(Q,M$(M.Z,"transfer"),2);f=Q.K;A=f.filter(mYB).sort(sAv);return A.length===0?Q.return():Q.return(A[0])})},qDW=function(M){var f,A,Q;
return g.n(function(N){if(N.Z==1){if(!M.K)return W0(M,"onTransferStart"),N.return();M.C.start(108E5);return g.r(N,Or(M,"TRANSFER_STATE_TRANSFERRING"),2)}f=M.K;return(Q=((A=f)==null?0:A.key)?g.M0(f.key).entityId:"")&&M.j?g.r(N,LC(Q,M.j,M.Z,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):N.CJ(0)})},ilB=function(M){var f,A,Q,N;
g.n(function(Y){switch(Y.Z){case 1:if(!M.K){W0(M,"onTransferPausedByUser");Y.CJ(2);break}f=M.K;M.C.stop();return g.r(Y,Or(M,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:Q=((A=f)==null?0:A.key)?g.M0(f.key).entityId:"";if(!Q||!M.j){Y.CJ(4);break}return g.r(Y,LC(Q,M.j,M.Z,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.r(Y,kh(M,Q),6);case 6:N=Y.K,qJe({videoId:Q,BB:f,offlineModeType:N});case 2:e6(M),bw(M),g.qc(Y)}})},xs0=function(M){var f,A,Q;
g.n(function(N){if(N.Z==1){if(!M.K)return W0(M,"onTransferPausedByNetwork"),N.return();M.C.stop();return g.r(N,Or(M,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(N.Z!=3)return f=M.K,(Q=((A=f)==null?0:A.key)?g.M0(f.key).entityId:"")&&M.j?g.r(N,LC(Q,M.j,M.Z,"DOWNLOAD_STATE_PAUSED"),3):N.CJ(3);e6(M);g.qc(N)})},cZW=function(M){var f,A,Q,N,Y;
g.n(function(I){switch(I.Z){case 1:if(!M.K)return W0(M,"onTransferComplete"),I.return();f=M.K;M.C.stop();if(!f||!M.N){I.CJ(2);break}A=R2B(M.api.T(),f.cotn,M.N);return g.r(I,Vb0(M,A),2);case 2:return g.r(I,Or(M,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:N=((Q=f)==null?0:Q.key)?g.M0(f.key).entityId:"";if(!N||!M.j){I.CJ(5);break}return g.r(I,LC(N,M.j,M.Z,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.r(I,hmW(M.Z,N),7);case 7:return g.r(I,kh(M,N),8);case 8:Y=I.K,ti({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:N,BB:f,offlineModeType:Y}),e6(M),bw(M),g.qc(I)}})},Rm9=function(M,f,A){var Q,N;
g.n(function(Y){switch(Y.Z){case 1:if(!M.K)return W0(M,"onTransferProgress: "+f),Y.return();if(M.K.transferState==="TRANSFER_STATE_TRANSFERRING"){Y.CJ(2);break}return g.r(Y,qDW(M),2);case 2:Q=Date.now();if(!(Q-M.z0>1E3)){Y.CJ(4);break}M.z0=Q;return g.r(Y,pvm(M.Z,A.videoId,A.Z,A.Oa,A.bytesDownloaded,A.K),5);case 5:if(M.B&&!(M.B&&Q-M.Er>M.YO)){Y.CJ(4);break}M.Er=Q;return g.r(Y,kh(M,f),7);case 7:N=Y.K,VM6({videoId:f,BB:M.K,offlineModeType:N},A.bytesDownloaded,A.K);case 4:M.C.start(108E5),g.qc(Y)}})},
g29=function(M){var f=(M.K.transferRetryCount||0)<3;
f&&(M=M.K,M.transferRetryCount=(M.transferRetryCount||0)+1);return f},BPW=function(M,f){f=f===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":f;
var A,Q,N,Y;return g.n(function(I){if(I.Z==1)return M.K||W0(M,"setTransferToFailed: "+f),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f==="TRANSFER_FAILURE_REASON_NETWORK"?A="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":f==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.r(I,Or(M,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",f),2);if(I.Z!=3)return Th(M.KJ,{entityKey:(Q=M.K)==null?void 0:Q.key,failureReason:A}),
N=M.K?g.M0(M.K.key).entityId:"",g.r(I,kh(M,N),3);Y=I.K;var D={videoId:N,BB:M.K,offlineModeType:Y},E=f,t={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};E&&(t.transferFailureReason=E,t.failureReason=HBB(E));ti(t,D);g.qc(I)})},Or=function(M,f,A,Q){var N;
return g.n(function(Y){if(Y.Z==1){if(!M.K)return W0(M,"saveTransferState: "+f),Y.return();M.K.transferState=f;M.K.failureReason=Q;g.HX(Y,2);return g.r(Y,age(M,function(I){return A?kN(I,"offlineVideoStreams",M.K.offlineVideoStreams).then(function(D){for(var E=g.V(D),t=E.next();!t.done;t=E.next())if((t=t.value)&&t.streamsProgress){t=g.V(t.streamsProgress);for(var v=t.next();!v.done;v=t.next())v.value.streamState=A}return c_K(I,D.filter(function(p){return!!p}),"offlineVideoStreams")}):g.gX.resolve(void 0)}),
4)}if(Y.Z!=2)return g.Rf(Y,0);
N=g.id(Y);return N instanceof g.au&&N.type==="QUOTA_EXCEEDED"?g.r(Y,M.Wp("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):Y.CJ(0)})},age=function(M,f){var A;
return g.n(function(Q){if(!M.K)return Q.return();A=M.K;return g.r(Q,Gx(M.Z,{mode:"readwrite",gq:!0},function(N){var Y=[O4(N,A,"transfer")];f&&Y.push(f(N));return g.gX.all(Y)}),0)})},e6=function(M){M.K=void 0;
M.N=void 0;M.C.stop()},H56=function(M,f){var A,Q,N,Y,I;
return g.n(function(D){if(D.Z==1)return A=g.M0(f.key),Q=A.entityId,N=g.fZ(Q,"playbackData"),g.r(D,lk(M.Z,N,"playbackData"),2);Y=D.K;if((I=Y)==null?0:I.playerResponseJson)return D.return(JSON.parse(Y.playerResponseJson));throw Error("No PlayerResponse found");})},W0=function(M,f){M.api.ZB("woffle",{mcte:f});
Yh("missing current transfer entity.")},kh=function(M,f){var A,Q,N;
return g.n(function(Y){if(Y.Z==1)return g.r(Y,lk(M.Z,g.fZ(f,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);A=Y.K;return Y.return((N=(Q=A)==null?void 0:Q.offlineModeType)!=null?N:void 0)})},mYB=function(M){return i50[M.transferState]!==void 0},sAv=function(M,f){var A=i50[M.transferState],Q=i50[f.transferState];
return A!==Q?A-Q:Number(M.enqueuedTimestampMs)-Number(f.enqueuedTimestampMs)},Xp=function(M,f){var A=this;
this.QY=M;this.api=f;this.G=new g.G8;this.N=new g.LB;this.Ed={kW:function(){return A.j.Ed.kW()},
HR:function(){return A.G},
DTO:function(){return A.j},
uH:function(){return A.uH()},
pw:function(){return A.pw()},
Uy:function(){return A.Uy()},
RJ:function(){return A.RJ()},
Gk:function(){return A.Gk()},
GC:function(Q){return A.GC(Q)}};
this.j=new h2W(function(){return xYC(A)},function(){A.Uy()},this.api.N_(),this.api.V.bind(this.api));
this.K=new Is(this.api);SJK(this.j)},xYC=function(M){return g.n(function(f){M.api.T0("onOrchestrationBecameLeader");
return g.r(f,M.pw(),0)})},rZ0=function(M){var f,A;
return g.n(function(Q){if(Q.Z==1)return g.r(Q,fC(),2);if(Q.Z!=3){f=Q.K;if(!f)return Yh("PES is undefined"),Q.return();M.Z=new SDW(f,M.api,M.j,M.K);A=M.VN(f);return g.r(Q,JC0(f,A,M.j,M.K,M.QY),3)}M.W=Q.K;return g.r(Q,Z5R(M),0)})},Z5R=function(M){var f;
return g.n(function(A){switch(A.Z){case 1:if(!M.Z)return Yh("transferManager is undefined"),A.return();if(M.Z.K){A.CJ(2);break}return g.r(A,bw(M.Z),2);case 2:if(!M.QY.V("woffle_enable_main_downloads_library")){A.CJ(4);break}return g.r(A,M.So(),4);case 4:if(!M.QY.V("html5_offline_playback_position_sync")){A.CJ(6);break}return g.r(A,M.vn(),7);case 7:return g.r(A,M.GC(864E5),6);case 6:return g.r(A,M.refreshAllStaleEntities(43200,!0),9);case 9:return g.r(A,M.O_(),10);case 10:if(!M.QY.V("html5_retry_downloads_for_expiration")){A.CJ(11);
break}return g.r(A,M.Gk(),11);case 11:return M.X=g.Vn(function(){M.refreshAllStaleEntities(43200,!0);M.O_()},9E5),g.AO(g.Nr(),function(){return M.RJ()}),g.r(A,fC(),13);
case 13:return f=A.K,g.r(A,piK(f),14);case 14:LBw(M.j),g.qc(A)}})},ur9=function(){var M,f,A,Q,N,Y;
return g.n(function(I){switch(I.Z){case 1:return g.r(I,fC(),2);case 2:M=I.K;if(!M)return I.return([]);f=Date.now()/1E3;return g.r(I,M$(M,"offlineVideoPolicy"),3);case 3:A=I.K,Q=g.V(A),N=Q.next();case 4:if(N.done){I.CJ(6);break}Y=N.value;if(!(Y.expirationTimestamp&&Number(Y.expirationTimestamp)<f)){I.CJ(5);break}Y.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";Y.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.r(I,wd(M,Y,"offlineVideoPolicy"),5);
case 5:N=Q.next();I.CJ(4);break;case 6:return I.return(A.map(function(D){return D.key}))}})},Ji=function(M,f,A,Q,N){var Y,I,D;
return g.n(function(E){if(E.Z==1)return g.r(E,fC(),2);Y=E.K;if(!Y)return E.return([]);I=f.map(function(t){var v=g.fZ(t,A);v={actionType:Q,entityKey:v,actionMetadata:Object.assign({},gWm(),N)};Q!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(v.actionMetadata.priority=0);t=new VD(A,t,v);return q$(t)});
D=zge(Y,I);SJK(M.j);return E.return(D)})},zm7=function(M,f,A,Q){var N,Y,I,D,E,t,v,p;
return g.n(function(h){switch(h.Z){case 1:N=[],Y=g.V(f),I=Y.next();case 2:if(I.done){h.CJ(4);break}D=I.value;if(D.upToDate||A&&!D.shouldAutoSyncMetadata||!D.playlistId){h.CJ(3);break}E={};switch(Q){case "mainPlaylistEntity":t={nextAutoRefreshIntervalSeconds:D.checkInSeconds,autoSync:A};E={mainPlaylistEntityActionMetadata:t};break;case "musicPlaylist":v={autoSync:A},E={musicPlaylistEntityActionMetadata:v}}return g.r(h,Ji(M,[D.playlistId],Q,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E),6);case 6:(p=
h.K)&&N.push.apply(N,g.c(p));case 3:I=Y.next();h.CJ(2);break;case 4:return h.return(N)}})},PrB=function(M,f){var A;
return g.n(function(Q){return f.length?(A=gWm(),g.bH(A,nC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),M.api.ZB("qrd",{v:f.length}),Q.return(Ji(M,f,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A))):Q.return([])})},n2B=function(M,f,A){this.K=M;
this.QY=f;this.j=A},Fs0=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R;
return g.n(function(u){switch(u.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey),N=Q.entityId,Y=[],g.HX(u,2),g.r(u,jAW(M,N),4);case 4:Y=u.K;if(!(M.QY.V("woffle_enable_main_downloads_library")&&((I=Y)==null?0:I.length))){u.CJ(5);break}return g.r(u,ywW(M.K,[f.entityKey]),5);case 5:g.Rf(u,3);break;case 2:return D=g.id(u),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.au&&D.type==="QUOTA_EXCEEDED"?(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Yh("Playlist add error"),u.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,E,t));case 3:v=[];if(!M.QY.V("html5_offline_prevent_redownload_downloaded_video")){u.CJ(7);break}return g.r(u,cwK(M.K,"mainVideoEntity",Y),8);case 8:Y=u.K;case 7:if((p=Y)==null?0:p.length)for(h=g.V(Y),S=h.next();!S.done;S=h.next())if(L=S.value,a=L.offlineVideoData,q=void 0,(q=a)==null?0:q.videoId)m=void 0,R=Number(((m=f.actionMetadata)==null?void 0:m.priority)||
0)+1,v.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"mainVideoEntity",R,KC,$Y9(f,a,N)));return u.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,v))}})},dYc=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK,x9,gD,TC,H,DU,JB,sI,Zv,UB,FT,jw,r7,B,x,Z,P,k,cX,Ab,af,Nc,rD,ld,cK,cT,zO,Op,X9,Xh,H1,hT,Zp,V4,rr,OY,XJ,gv,I9,J6,DL,BL,OG;
return g.n(function(UI){switch(UI.Z){case 1:return A=v0(f),Q=f.entityKey,N=g.M0(Q).entityId,Y=[],I=!1,N==="!*$_ALL_ENTITIES_!*$"?(I=!0,g.r(UI,M$(M.K,"mainPlaylistEntity"),5)):g.r(UI,lk(M.K,Q,"mainPlaylistEntity"),4);case 4:(D=UI.K)&&Y.push(D);UI.CJ(3);break;case 5:Y=UI.K;case 3:if((E=Y)==null||!E.length)return UI.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));t=g.b(f.actionMetadata,yZ0);p=(v=t)==null?void 0:v.nextAutoRefreshIntervalSeconds;S=(h=t)==null?void 0:h.autoSync;L=[];q=a=
!0;m=!1;if(!I&&S===!1){UI.CJ(6);break}g.HX(UI,7);return g.r(UI,fIm(0,!!S,!0,Y),9);case 9:L=UI.K;g.Rf(UI,8);break;case 7:R=g.id(UI);if(!(R instanceof Error&&R.message==="No data")){R instanceof Error&&R.message==="Empty response body"&&Yh(R.message);UI.CJ(8);break}return N==="!*$_ALL_ENTITIES_!*$"?g.r(UI,z2c(M.K,f,M.j,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.r(UI,rwR(N,M.K,f,M.j),8);case 8:if(!L.length||!I&&L[0].playlistId!==N)return UI.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A));case 6:if(I){u=[];z=g.V(L);for(e=z.next();!e.done;e=z.next())G=e.value,G.upToDate||S&&!G.shouldAutoSyncMetadata||!G.playlistId||(X={nextAutoRefreshIntervalSeconds:G.checkInSeconds,autoSync:S},u.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",G.playlistId,"mainPlaylistEntity",0,KC,{mainPlaylistEntityActionMetadata:X})));return UI.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,u))}L.length&&(Qt=L[0],m=!!Qt.upToDate,S&&(a=(Y9=Qt.shouldAutoSyncMetadata)!=null?Y9:!0,q=(Mc=Qt.shouldAutoSyncVideos)!=
null?Mc:!0,Qt.checkInSeconds&&(p=Qt.checkInSeconds)));if(m||!a)return UI.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));E0=[];w=Y[0];if(!w.downloadState){m6=void 0;UI.CJ(15);break}return g.r(UI,lk(M.K,w.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:m6=UI.K;case 15:return BX=m6,g7=((WX=BX)==null?0:WX.addedTimestampMillis)?String(BX.addedTimestampMillis):void 0,g.HX(UI,17),g.r(UI,jAW(M,N,g7,p),19);case 19:E0=UI.K;g.Rf(UI,18);break;case 17:vK=g.id(UI);if(!(vK instanceof
Error&&vK.message==="No data for playlist")){if(vK instanceof Error&&vK.message==="Empty response body for playlist")Yh(vK.message);else return x9="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",gD="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",vK instanceof g.au&&vK.type==="QUOTA_EXCEEDED"&&(x9="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",gD="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),UI.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,x9,gD));
UI.CJ(18);break}return g.r(UI,rwR(N,M.K,f,M.j),18);case 18:if(!q)return UI.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));TC=[];H=new Map;if((DU=E0)==null?0:DU.length)for(JB=g.V(E0),sI=JB.next();!sI.done;sI=JB.next())Zv=sI.value,UB=Zv.offlineVideoData,FT=void 0,((FT=UB)==null?0:FT.videoId)&&H.set(UB.videoId,UB);jw=new Map;r7=[];if((B=w)==null?0:(x=B.videos)==null?0:x.length)for(Z=g.V(w.videos),P=Z.next();!P.done;P=Z.next())if(k=P.value,cX=JSON.parse(g.M0(k).entityId),Ab=cX.videoId)H.has(Ab)?
(jw.set(Ab,H.get(Ab)),H.delete(Ab)):r7.push(Ab);Nc=Number(((af=f.actionMetadata)==null?void 0:af.priority)||0)+1;rD=g.V(H.entries());for(ld=rD.next();!ld.done;ld=rD.next())cK=ld.value,cT=g.V(cK),zO=cT.next().value,Op=cT.next().value,X9=zO,Xh=Op,TC.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",X9,"mainVideoEntity",Nc,KC,$Y9(f,Xh,N)));H1=g.V(jw.entries());for(hT=H1.next();!hT.done;hT=H1.next())Zp=hT.value,V4=g.V(Zp),rr=V4.next().value,OY=V4.next().value,XJ=rr,gv=OY,TC.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
XJ,"mainVideoEntity",Nc,KC,$Y9(f,gv,N)));I9=g.V(r7);for(J6=I9.next();!J6.done;J6=I9.next())DL=J6.value,BL={playlistId:N},OG={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:BL},TC.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",DL,"mainVideoEntity",0,KC,OG));return UI.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,TC))}})},emW=function(M,f){var A,Q,N,Y;
return g.n(function(I){switch(I.Z){case 1:return A=v0(f),g.HX(I,2),Q=g.M0(f.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.r(I,z2c(M.K,f,M.j,(N=f.actionMetadata)==null?void 0:(Y=N.offlineLoggingData)==null?void 0:Y.offlineDeleteReason),5):g.r(I,rwR(Q,M.K,f,M.j),6);case 6:if(!M.QY.V("woffle_enable_main_downloads_library")){I.CJ(5);break}return g.r(I,dlK(M.K,f.entityKey),5);case 5:g.Rf(I,3);break;case 2:return g.id(I),I.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return I.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A))}})},jAW=function(M,f,A,Q){var N,Y,I,D,E,t,v;
return g.n(function(p){switch(p.Z){case 1:return g.r(p,lRR([f]),2);case 2:return N=p.K,g.r(p,b5m(M,N[0],A,Q),3);case 3:return Y=p.K,I=Y.mainPlaylistEntity,D=Y.rhN,t=xlc(I,(E=D)==null?void 0:E.avatar),g.HX(p,4),g.r(p,m7(t),6);case 6:g.Rf(p,5);break;case 4:v=g.id(p),v instanceof Error&&v.message==="Failed to fetch"&&Yh(v.message);case 5:return p.return(N[0].videos)}})},b5m=function(M,f,A,Q){var N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z;
return g.n(function(e){switch(e.Z){case 1:N=Date.now().toString();A||(A=N);Y=f.videos;I=f.playlistId;D=[];E=[];if(Y)for(t=g.V(Y),v=t.next();!v.done;v=t.next()){p=v.value;h=p.offlineVideoData;if(!h||!h.videoId)throw Yh("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");S=h.videoId;L={videoId:S,playlistId:I};a={id:g.fZ(JSON.stringify(L),"mainPlaylistVideoEntity"),video:g.fZ(S,"mainVideoEntity")};D.push(a);E.push(a.id)}m={key:g.fZ(I,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:A,lastSyncedTimestampMillis:N};R={key:g.fZ(I,"mainPlaylistEntity"),playlistId:I,videos:E,title:f.title,thumbnailStyleData:kiB(f),visibility:WsW(f),downloadState:m.key};f.channel&&(u=f.channel.offlineChannelData,q=O5m(g.fZ(I,"ytMainChannelEntity"),u),R.channelOwner=q.id);((z=R)==null?0:z.entityMetadata)?(R.entityMetadata.offlineLastModifiedTimestampSeconds=f.lastModifiedTimestamp,Q&&(R.entityMetadata.nextAutoRefreshIntervalSeconds=String(Q))):R&&(R.entityMetadata={nextAutoRefreshIntervalSeconds:Q?
String(Q):void 0,offlineLastModifiedTimestampSeconds:f.lastModifiedTimestamp});g.HX(e,2);return g.r(e,Gx(M.K,{mode:"readwrite",gq:!0},function(G){var X=O4(G,R,"mainPlaylistEntity"),Qt=O4(G,m,"mainPlaylistDownloadStateEntity");X=[X,Qt];Qt=g.V(D);for(var Y9=Qt.next();!Y9.done;Y9=Qt.next())X.push(O4(G,Y9.value,"mainPlaylistVideoEntity"));q&&X.push(O4(G,q,"ytMainChannelEntity"));return g.gX.all(X)}),4);
case 4:g.Rf(e,3);break;case 2:throw g.id(e),Yh("PES failure for playlist"),Error("PES failure for playlist");case 3:return e.return({mainPlaylistEntity:R,rhN:q,g1B:D})}})},O5m=function(M,f){return{id:M,
channelId:f.channelId,title:f.title,avatar:f.thumbnail}},kiB=function(M){var f=[],A=M.videos;
A&&A.length>0&&f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:A[0].offlineVideoData.thumbnail}}});if((M=M.additionalMetadadatas)&&M.length>0)for(M=g.V(M),A=M.next();!A.done;A=M.next()){var Q=A.value.offlineBundleItemPlaylistData,N=void 0;A=(N=Q)==null?void 0:N.style;N=void 0;Q={collageThumbnail:{coverThumbnail:(N=Q)==null?void 0:N.coverThumbnail}};switch(A){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:Q});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:Q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:Q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":f.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:Q})}}return f},WsW=function(M){switch(M.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},$Y9=function(M,f,A){f={offlineVideoData:f,
playlistId:A};if(M=g.b(M.actionMetadata,yZ0))f.maximumDownloadQuality=M.maximumDownloadQuality;return{mainVideoEntityActionMetadata:f}},Xvc=function(M,f,A){this.K=M;
this.QY=f;this.j=A},Gic=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L;
return g.n(function(a){switch(a.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey),N=Q.entityId,Y=g.b(f.actionMetadata,Gh),D=!((I=Y)==null?0:I.playlistId),g.HX(a,2),g.r(a,JZ7(M,N,void 0,(E=Y)==null?void 0:E.offlineVideoData,D),4);case 4:g.Rf(a,3);break;case 2:return t=g.id(a),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.au&&t.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
a.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,v,p));case 3:h=1;h=Number(((S=f.actionMetadata)==null?void 0:S.priority)||0)+1;var q=(q=g.b(f.actionMetadata,Gh))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;L=zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N,"playbackData",h,KsC,q);return a.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,[L]))}})},wv0=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R;
return g.n(function(u){switch(u.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey),N=Q.entityId,g.r(u,lk(M.K,f.entityKey,"mainVideoEntity"),2);case 2:Y=u.K;if(!Y){I=void 0;u.CJ(3);break}return g.r(u,lk(M.K,Y.downloadState,"mainVideoDownloadStateEntity"),4);case 4:I=u.K;case 3:D=I;if(!Y||!D)return u.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));g.HX(u,5);return g.r(u,JZ7(M,N,D.addedTimestampMillis,(t=g.b(f.actionMetadata,Gh))==null?void 0:t.offlineVideoData),7);case 7:v=1;v=Number(((p=
f.actionMetadata)==null?void 0:p.priority)||0)+1;E=zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N,"playbackData",v,KsC);g.Rf(u,6);break;case 5:h=g.id(u);if(!(h instanceof Error&&h.message==="No data")){if(h instanceof Error&&h.message==="Empty response body")Yh(h.message);else return S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.au&&h.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,S,L));u.CJ(6);break}return g.r(u,Rs(M.K,N),9);case 9:a=u.K;q=g.b(f.actionMetadata,Gh);if(R=(m=q)==null?void 0:m.playlistId)a.playlistId=R;a.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.r(u,sr(N,M.K,f,M.j,a),6);case 6:return u.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,E?[E]:void 0))}})},lgC=function(M,f){var A,Q,N,Y,I,D,E,t,v,p;
return g.n(function(h){switch(h.Z){case 1:return A=v0(f),g.HX(h,2),Q=g.M0(f.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.r(h,z2c(M.K,f,M.j,(v=f.actionMetadata)==null?void 0:(p=v.offlineLoggingData)==null?void 0:p.offlineDeleteReason),5):g.r(h,Rs(M.K,Q),6);case 6:N=h.K;Y=g.b(f.actionMetadata,Gh);if(D=(I=Y)==null?void 0:I.playlistId)N.playlistId=D;N.offlineDeleteReason=(E=f.actionMetadata)==null?void 0:(t=E.offlineLoggingData)==null?void 0:t.offlineDeleteReason;return g.r(h,sr(Q,M.K,f,M.j,N),7);
case 7:if(!M.QY.V("woffle_enable_main_downloads_library")){h.CJ(5);break}return g.r(h,dlK(M.K,f.entityKey),5);case 5:g.Rf(h,3);break;case 2:return g.id(h),h.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A))}})},JZ7=function(M,f,A,Q,N){var Y,I,D,E,t,v;
return g.n(function(p){switch(p.Z){case 1:if(Y=Q){p.CJ(2);break}return g.r(p,wie([f]),3);case 3:I=p.K,Y=I[0];case 2:return g.r(p,Moc(M,Y,A,N),4);case 4:D=p.K;E=D.mainVideoEntity;t=D.channelEntity;g.HX(p,5);var h=Ur(E.thumbnail),S=Ur(t.avatar);return g.r(p,m7(h.concat(S)),7);case 7:g.Rf(p,0);break;case 5:v=g.id(p),v instanceof Error&&v.message==="Failed to fetch"&&Yh(v.message),g.qc(p)}})},Moc=function(M,f,A,Q){var N,Y,I,D,E,t,v,p,h,S,L,a,q;
return g.n(function(m){switch(m.Z){case 1:A||(A=Date.now().toString());Y=(N=f.channel)==null?void 0:N.offlineChannelData;I={id:g.fZ(f.videoId,"ytMainChannelEntity"),channelId:Y.channelId,title:Y.title,avatar:Y.thumbnail};D={key:g.fZ(f.videoId,"mainVideoDownloadStateEntity"),playbackData:g.fZ(f.videoId,"playbackData"),addedTimestampMillis:A,videoDownloadContextEntity:g.fZ(f.videoId,"videoDownloadContextEntity")};E={key:g.fZ(f.videoId,"videoPlaybackPositionEntity"),videoId:f.videoId,lastPlaybackPositionSeconds:"0"};
M.QY.V("html5_offline_playback_position_sync")&&(t={playbackPosition:E.key});v=g.fZ(f.videoId,"mainVideoEntity");p={key:v,videoId:f.videoId,title:f.title,thumbnail:f.thumbnail,localizedStrings:{viewCount:f.shortViewCountText},userState:t,lengthSeconds:f.lengthSeconds?Number(f.lengthSeconds):void 0,publishedTimestampMillis:f.publishedTimestamp?(Number(f.publishedTimestamp)*1E3).toString():void 0,formattedDescription:f.description,owner:I.id,downloadState:D.key};if(!M.QY.V("woffle_enable_main_downloads_library")||
!Q){m.CJ(2);break}return g.r(m,FBw(M.K,[v]),3);case 3:if(L=m.K)h=L.mainDownloadsLibraryEntity,S=L.mainDownloadsListEntity;case 2:return q=sc9,a={key:g.fZ(f.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.bH(D,q,a),g.r(m,Gx(M.K,{mode:"readwrite",gq:!0},function(R){var u=O4(R,I,"ytMainChannelEntity"),z=O4(R,D,"mainVideoDownloadStateEntity"),e=O4(R,p,"mainVideoEntity");u=[u,z,e];M.QY.V("html5_offline_playback_position_sync")&&(z=O4(R,E,"videoPlaybackPositionEntity"),
u.push(z));h&&(z=O4(R,h,"mainDownloadsLibraryEntity"),u.push(z));S&&(z=O4(R,S,"mainDownloadsListEntity"),u.push(z));a&&(R=O4(R,a,"downloadStatusEntity"),u.push(R));return g.gX.all(u)}),4);
case 4:return m.return({mainVideoEntity:p,channelEntity:I})}})},fSv=function(M,f,A){this.K=M;
this.QY=f;this.j=A},QbB=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w;
return g.n(function(m6){switch(m6.Z){case 1:return A=v0(f),Q=[],g.r(m6,yg.getInstance(),2);case 2:N=m6.K;if(!N){m6.CJ(3);break}return g.r(m6,N.get("sdois"),4);case 4:return Y=m6.K,g.r(m6,(D=N)==null?void 0:D.get("lmqf"),5);case 5:I=m6.K;case 3:g.HX(m6,6);if(Y===void 0)throw Error("prefStorage or opt-in state is undefined");E=[];if(Y){m6.CJ(8);break}return g.r(m6,$l9(M.K),9);case 9:E=m6.K,E.reverse();case 8:if(!E.length){m6.CJ(10);break}t=g.V(E);v=t.next();case 11:if(v.done){m6.CJ(10);break}p=v.value;
if(!p){m6.CJ(12);break}h=g.M0(p).entityId;return g.r(m6,Rs(M.K,h),14);case 14:return S=m6.K,S.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.r(m6,sr(h,M.K,{entityKey:p,actionType:f.actionType},M.j,S),12);case 12:v=t.next();m6.CJ(11);break;case 10:return g.r(m6,Qmc(Y,(L=I)!=null?L:"SD"),16);case 16:return a=m6.K,g.r(m6,PRC(a),17);case 17:q=jcB(a);if(!M.QY.V("woffle_enable_main_downloads_library")){m6.CJ(18);break}if(Y){m6.CJ(19);break}return g.r(m6,dlK(M.K,g.nR),19);case 19:return g.r(m6,
ywW(M.K,[g.nR]),18);case 18:if((m=q)==null?0:m.length)for(R=g.V(q),u=R.next();!u.done;u=R.next())if(e=z=u.value,G=e.actionType,X=e.entityKey,Qt=e.actionMetadata,G&&X&&Qt&&!g.b(Qt,A39)){G==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Qt.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Y9=g.b(z.actionMetadata,Gh))Y9.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",z.actionMetadata=Object.assign({},z.actionMetadata,{mainVideoEntityActionMetadata:Y9});Q.push(z)}g.Rf(m6,
7);break;case 6:return Mc=g.id(m6),E0="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Mc instanceof g.au&&Mc.type==="QUOTA_EXCEEDED"&&(E0="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m6.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,E0,w));case 7:return m6.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,Q))}})},NB0=function(){Xp.apply(this,
arguments);
this.B="mainVideoEntity"},YGe=function(M,f,A){f=f===void 0?43200:f;
A=A===void 0?!0:A;var Q=Q===void 0?!1:Q;var N,Y,I;return g.n(function(D){switch(D.Z){case 1:if(!M.G.Ag())return D.return([]);N=[];g.HX(D,2);return g.r(D,fIm(f,A,Q),4);case 4:N=D.K;g.Rf(D,3);break;case 2:Y=g.id(D),Y instanceof Error&&Y.message==="No data"||Y instanceof Error&&Y.message==="Empty response body"&&Yh(Y.message);case 3:return I=zm7(M,N,A,"mainPlaylistEntity"),D.return(I)}})},ISe=function(M,f,A,Q){Q=Q===void 0?!1:Q;
var N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R;return g.n(function(u){switch(u.Z){case 1:return N=[],g.r(u,ACw(),2);case 2:return(Y=u.K)||Q?g.r(u,N8K(f,A),3):u.return([]);case 3:I=u.K;if((D=I)==null||!D.length)return u.return([]);E={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};t=g.V(I);v=t.next();case 4:if(v.done){u.CJ(6);break}h=p=v.value;S=h.actionType;L=h.entityKey;a=h.actionMetadata;if(!(S&&L&&a)||g.b(a,A39)){u.CJ(5);break}S==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(a.offlineLoggingData=
E);q=g.M0(L);m=q.entityId;return g.r(u,Ji(M,[m],"mainVideoEntity",S,a),8);case 8:R=u.K,N=N.concat(R);case 5:v=t.next();u.CJ(4);break;case 6:return u.return(N)}})},TB6=function(M,f){this.K=M;
this.j=f},ES9=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m;
return g.n(function(R){switch(R.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey),N=Q.entityId,Y=[],g.HX(R,2),g.r(R,D4B(M,N),4);case 4:Y=R.K;if((I=Y)==null||!I.length){R.CJ(5);break}return g.r(R,OBc(M.K,f.entityKey),5);case 5:g.Rf(R,3);break;case 2:return D=g.id(R),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.au&&D.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,E,t));case 3:return v=[],g.r(R,cwK(M.K,"musicTrack",Y),7);case 7:Y=R.K;if(Y.length)for(p=g.V(Y),h=p.next();!h.done;h=p.next())if(S=h.value,L=S.offlineVideoData,a=void 0,(a=L)==null?0:a.videoId)q=void 0,m=Number(((q=f.actionMetadata)==null?void 0:q.priority)||0)+1,v.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L.videoId,"musicTrack",m,wl,xh(f,L,N)));return R.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,v))}})},
toK=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK,x9,gD,TC,H,DU,JB,sI,Zv,UB,FT,jw,r7,B,x,Z,P,k,cX,Ab,af,Nc,rD,ld,cK,cT,zO,Op;
return g.n(function(X9){switch(X9.Z){case 1:return A=v0(f),Q=f.entityKey,N=g.M0(Q).entityId,Y=[],I=!1,N==="!*$_ALL_ENTITIES_!*$"?(I=!0,g.r(X9,M$(M.K,"musicAlbumRelease"),5)):g.r(X9,lk(M.K,Q,"musicAlbumRelease"),4);case 4:(D=X9.K)&&Y.push(D);X9.CJ(3);break;case 5:Y=X9.K;case 3:if((E=Y)==null||!E.length)return X9.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));if(I){t=[];v=g.V(Y);for(p=v.next();!p.done;p=v.next())h=p.value,S=g.M0(h.id).entityId,t.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
S,"musicAlbumRelease",0,wl));return X9.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,t))}L=[];a=Y[0];q=void 0;if(!a.downloadMetadata){X9.CJ(6);break}return g.r(X9,lk(M.K,a.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:m=X9.K,q=Number((u=(R=m)==null?void 0:R.addedTimestampMillis)!=null?u:"0")/1E3;case 6:return g.HX(X9,8),g.r(X9,D4B(M,N,(z=q)==null?void 0:z.toString()),10);case 10:L=X9.K;g.Rf(X9,9);break;case 8:e=g.id(X9);if(!(e instanceof Error&&e.message===
"No data")){if(e instanceof Error&&e.message==="Empty response body")Yh(e.message);else return G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.au&&e.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),X9.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,G,X));X9.CJ(9);break}return g.r(X9,B0(N,"musicAlbumRelease",M.K,
f,M.j),9);case 9:Qt=[];Y9=new Map;if((Mc=L)==null?0:Mc.length)for(E0=g.V(L),w=E0.next();!w.done;w=E0.next())m6=w.value,BX=m6.offlineVideoData,WX=void 0,((WX=BX)==null?0:WX.videoId)&&Y9.set(BX.videoId,BX);g7=new Map;vK=[];if((x9=a)==null?0:(gD=x9.tracks)==null?0:gD.length)for(TC=g.V(a.tracks),H=TC.next();!H.done;H=TC.next())if(DU=H.value,JB=g.M0(DU).entityId)Y9.has(JB)?(g7.set(JB,Y9.get(JB)),Y9.delete(JB)):vK.push(JB);Zv=Number(((sI=f.actionMetadata)==null?void 0:sI.priority)||0)+1;UB=g.V(Y9.entries());
for(FT=UB.next();!FT.done;FT=UB.next())jw=FT.value,r7=g.V(jw),B=r7.next().value,x=r7.next().value,Z=B,P=x,Qt.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z,"musicTrack",Zv,wl,xh(f,P)));k=g.V(g7.entries());for(cX=k.next();!cX.done;cX=k.next())Ab=cX.value,af=g.V(Ab),Nc=af.next().value,rD=af.next().value,ld=Nc,cK=rD,Qt.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",ld,"musicTrack",Zv,wl,xh(f,cK)));cT=g.V(vK);for(zO=cT.next();!zO.done;zO=cT.next())Op=zO.value,Qt.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Op,"musicTrack",0,wl));return X9.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,Qt))}})},vSm=function(M,f){var A,Q;
return g.n(function(N){switch(N.Z){case 1:return A=v0(f),g.HX(N,2),Q=g.M0(f.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.r(N,iw(M.K,f,M.j),5):g.r(N,B0(Q,"musicAlbumRelease",M.K,f,M.j),6);case 6:return g.r(N,XiB(M.K,f.entityKey),5);case 5:g.Rf(N,3);break;case 2:return g.id(N),N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A))}})},D4B=function(M,f,A){var Q,N,Y;
return g.n(function(I){switch(I.Z){case 1:return g.r(I,lRR([f]),2);case 2:return Q=I.K,g.r(I,pJC(M,Q[0],A),3);case 3:return N=I.K,Y=Ur(N.thumbnailDetails),g.r(I,m7(Y),4);case 4:return I.return(Q[0].videos)}})},pJC=function(M,f,A){var Q,N,Y,I,D,E,t,v,p,h,S,L,a,q;
return g.n(function(m){if(m.Z==1){Q=f.additionalMetadadatas;N=void 0;if(Q&&Q.length>0)for(Y=g.V(Q),I=Y.next();!I.done;I=Y.next())if(D=I.value,D.offlineMusicPlaylistData){N=D.offlineMusicPlaylistData;break}E=f.playlistId;t=Jwm(f);v=t.Nq;p=t.Gl;h=A?(Number(A)*1E3).toString():Date.now().toString();S=f.lastModifiedTimestamp?(Number(f.lastModifiedTimestamp)*1E3).toString():"0";L={id:g.fZ(E,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:p,lastModifiedTimestampMillis:S,addedTimestampMillis:h,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};a={id:g.fZ(E,"musicAlbumRelease"),title:f.title,audioPlaylistId:E,trackCount:f.totalVideoCount,tracks:v,downloadMetadata:L.id};N&&(a.thumbnailDetails=(q=N.albumHqThumbnail)!=null?q:N.albumArtistThumbnail,a.artistDisplayName=N.albumArtistDisplayName,a.releaseDate=N.albumReleaseDate,a.contentRating={explicitType:N.albumReleaseExplicitType},a.releaseType=N.albumReleaseType);return g.r(m,Gx(M.K,{mode:"readwrite",gq:!0},function(R){var u=O4(R,a,"musicAlbumRelease");
R=O4(R,L,"musicAlbumReleaseDownloadMetadataEntity");return g.gX.all([u,R])}),2)}return m.return(a)})},hre=function(M,f){this.K=M;
this.j=f},Lmc=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m;
return g.n(function(R){switch(R.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey),N=Q.entityId,Y=[],g.HX(R,2),g.r(R,SGv(M,N),4);case 4:Y=R.K;if((I=Y)==null||!I.length){R.CJ(5);break}return g.r(R,OBc(M.K,f.entityKey),5);case 5:g.Rf(R,3);break;case 2:return D=g.id(R),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.au&&D.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,E,t));case 3:return v=[],g.r(R,cwK(M.K,"musicTrack",Y),7);case 7:Y=R.K;if(Y.length)for(p=g.V(Y),h=p.next();!h.done;h=p.next())if(S=h.value,L=S.offlineVideoData,a=void 0,(a=L)==null?0:a.videoId)q=void 0,m=Number(((q=f.actionMetadata)==null?void 0:q.priority)||0)+1,v.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L.videoId,"musicTrack",m,lw,xh(f,L,N)));return R.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,v))}})},
oS0=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK,x9,gD,TC,H,DU,JB,sI,Zv,UB,FT,jw,r7,B,x,Z,P,k,cX,Ab,af,Nc,rD,ld,cK,cT,zO,Op,X9,Xh,H1,hT,Zp,V4,rr,OY,XJ,gv,I9,J6;
return g.n(function(DL){switch(DL.Z){case 1:return A=v0(f),Q=f.entityKey,N=g.M0(Q).entityId,Y=[],I=!1,N==="!*$_ALL_ENTITIES_!*$"?(I=!0,g.r(DL,M$(M.K,"musicPlaylist"),5)):g.r(DL,lk(M.K,Q,"musicPlaylist"),4);case 4:(D=DL.K)&&Y.push(D);DL.CJ(3);break;case 5:Y=DL.K;case 3:if((E=Y)==null||!E.length)return DL.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));t=g.b(f.actionMetadata,KBc);p=(v=t)==null?void 0:v.autoSync;h=[];L=S=!0;a=!1;q=void 0;if(!I&&p===!1){DL.CJ(6);break}g.HX(DL,7);return g.r(DL,
YkW(0,!!p,!0,Y),9);case 9:h=DL.K;g.Rf(DL,8);break;case 7:m=g.id(DL);if(!(m instanceof Error&&m.message==="No data")){m instanceof Error&&m.message==="Empty response body"&&Yh(m.message);DL.CJ(8);break}return N==="!*$_ALL_ENTITIES_!*$"?g.r(DL,iw(M.K,f,M.j),8):g.r(DL,B0(N,"musicPlaylist",M.K,f,M.j),8);case 8:if(!h.length||!I&&h[0].playlistId!==N)return DL.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));case 6:if(I){R=[];u=g.V(h);for(z=u.next();!z.done;z=u.next())e=z.value,e.upToDate||
p&&!e.shouldAutoSyncMetadata||!e.playlistId||(G={autoSync:p},R.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e.playlistId,"musicPlaylist",0,lw,{musicPlaylistEntityActionMetadata:G})));return DL.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,R))}h.length&&(X=h[0],a=!!X.upToDate,p&&(S=(Qt=X.shouldAutoSyncMetadata)!=null?Qt:!0,L=(Y9=X.shouldAutoSyncVideos)!=null?Y9:!0,X.checkInSeconds&&(q=X.checkInSeconds)));if(a||!S)return DL.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A));Mc=[];E0=Y[0];w=void 0;if(!E0.downloadMetadata){DL.CJ(15);break}return g.r(DL,lk(M.K,E0.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:m6=DL.K,w=Number((WX=(BX=m6)==null?void 0:BX.addedTimestampMillis)!=null?WX:"0")/1E3;case 15:return g.HX(DL,17),g.r(DL,SGv(M,N,(g7=w)==null?void 0:g7.toString(),q),19);case 19:Mc=DL.K;g.Rf(DL,18);break;case 17:vK=g.id(DL);if(!(vK instanceof Error&&vK.message==="No data")){if(vK instanceof Error&&vK.message==="Empty response body")Yh(vK.message);
else return x9="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",gD="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",vK instanceof g.au&&vK.type==="QUOTA_EXCEEDED"&&(x9="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",gD="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),DL.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,x9,gD));DL.CJ(18);break}return g.r(DL,B0(N,"musicPlaylist",M.K,f,M.j),18);case 18:if(!L)return DL.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A));TC=[];H=new Map;if((DU=Mc)==null?0:DU.length)for(JB=g.V(Mc),sI=JB.next();!sI.done;sI=JB.next())Zv=sI.value,UB=Zv.offlineVideoData,FT=void 0,((FT=UB)==null?0:FT.videoId)&&H.set(UB.videoId,UB);jw=new Map;r7=[];if((B=E0)==null?0:(x=B.tracks)==null?0:x.length)for(Z=g.V(E0.tracks),P=Z.next();!P.done;P=Z.next())if(k=P.value,cX=g.M0(k).entityId)H.has(cX)?(jw.set(cX,H.get(cX)),H.delete(cX)):r7.push(cX);af=Number(((Ab=f.actionMetadata)==null?void 0:Ab.priority)||0)+1;Nc=g.V(H.entries());for(rD=Nc.next();!rD.done;rD=
Nc.next())ld=rD.value,cK=g.V(ld),cT=cK.next().value,zO=cK.next().value,Op=cT,X9=zO,TC.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Op,"musicTrack",af,lw,xh(f,X9)));Xh=g.V(jw.entries());for(H1=Xh.next();!H1.done;H1=Xh.next())hT=H1.value,Zp=g.V(hT),V4=Zp.next().value,rr=Zp.next().value,OY=V4,XJ=rr,TC.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",OY,"musicTrack",af,lw,xh(f,XJ)));gv=g.V(r7);for(I9=gv.next();!I9.done;I9=gv.next())J6=I9.value,TC.push(zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
J6,"musicTrack",0,lw));return DL.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,TC))}})},CGC=function(M,f){var A,Q;
return g.n(function(N){switch(N.Z){case 1:return A=v0(f),g.HX(N,2),Q=g.M0(f.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.r(N,iw(M.K,f,M.j),5):g.r(N,B0(Q,"musicPlaylist",M.K,f,M.j),6);case 6:return g.r(N,XiB(M.K,f.entityKey),5);case 5:g.Rf(N,3);break;case 2:return g.id(N),N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A))}})},SGv=function(M,f,A,Q){var N,Y,I;
return g.n(function(D){switch(D.Z){case 1:return g.r(D,lRR([f]),2);case 2:return N=D.K,g.r(D,U46(M,N[0],A,Q),3);case 3:return Y=D.K,I=Ur(Y.thumbnailDetails),g.r(D,m7(I),4);case 4:return D.return(N[0].videos)}})},U46=function(M,f,A,Q){var N,Y,I,D,E,t,v,p,h;
return g.n(function(S){return S.Z==1?(N=f.playlistId,Y=Jwm(f),I=Y.Nq,D=Y.Gl,E=A?(Number(A)*1E3).toString():Date.now().toString(),t=f.lastModifiedTimestamp?(Number(f.lastModifiedTimestamp)*1E3).toString():"0",v={id:g.fZ(N,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:t,addedTimestampMillis:E,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},p={id:g.fZ(N,"musicPlaylist"),title:f.title,playlistId:N,thumbnailDetails:f.thumbnail,visibility:VoW(f),trackCount:f.totalVideoCount,
tracks:I,downloadMetadata:v.id},Q&&(((h=p)==null?0:h.entityMetadata)?p.entityMetadata.nextAutoRefreshIntervalSeconds=String(Q):p&&(p.entityMetadata={nextAutoRefreshIntervalSeconds:String(Q)})),g.r(S,Gx(M.K,{mode:"readwrite",gq:!0},function(L){var a=O4(L,p,"musicPlaylist");L=O4(L,v,"musicPlaylistDownloadMetadataEntity");return g.gX.all([a,L])}),2)):S.return(p)})},VoW=function(M){switch(M.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},aSc=function(M,f){this.K=M;
this.j=f},sb7=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L;
return g.n(function(a){switch(a.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey),N=Q.entityId,Y=g.b(f.actionMetadata,qGw),g.HX(a,2),g.r(a,H4m(M,N,void 0,(I=Y)==null?void 0:I.track,(D=Y)==null?void 0:D.albumRelease),4);case 4:if((E=Y)==null?0:E.playlistId){a.CJ(5);break}return g.r(a,OBc(M.K,f.entityKey),5);case 5:g.Rf(a,3);break;case 2:return t=g.id(a),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.au&&t.type==="QUOTA_EXCEEDED"&&
(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),a.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,v,p));case 3:S=Number(((h=f.actionMetadata)==null?void 0:h.priority)||0)+1;var q=(q=g.b(f.actionMetadata,qGw))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;L=zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N,"playbackData",S,m4K,q);return a.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A,[L]))}})},c30=function(M,f){var A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q;
return g.n(function(m){switch(m.Z){case 1:return A=v0(f),Q=g.M0(f.entityKey),N=Q.entityId,g.r(m,lk(M.K,f.entityKey,"musicTrack"),2);case 2:Y=m.K;if(!Y){I=void 0;m.CJ(3);break}return g.r(m,lk(M.K,Y.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:I=m.K;case 3:D=I;if(!Y||!D)return m.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A));t=g.b(f.actionMetadata,qGw);g.HX(m,5);return g.r(m,H4m(M,N,D.addedTimestampMillis,(v=t)==null?void 0:v.track,(p=t)==null?void 0:p.albumRelease),
7);case 7:S=Number(((h=f.actionMetadata)==null?void 0:h.priority)||0)+1;E=zh("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N,"playbackData",S,m4K);g.Rf(m,6);break;case 5:L=g.id(m);if(!(L instanceof Error&&L.message==="No data")){if(L instanceof Error&&L.message==="Empty response body")Yh(L.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.au&&L.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,a,q));m.CJ(6);break}return g.r(m,gl(N,M.K,f,M.j),6);case 6:return m.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",A,E?[E]:void 0))}})},RrB=function(M,f){var A,Q;
return g.n(function(N){switch(N.Z){case 1:return A=v0(f),g.HX(N,2),Q=g.M0(f.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.r(N,iw(M.K,f,M.j),5):g.r(N,gl(Q,M.K,f,M.j),6);case 6:return g.r(N,XiB(M.K,f.entityKey),5);case 5:g.Rf(N,3);break;case 2:return g.id(N),N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",A,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new P0("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
A))}})},H4m=function(M,f,A,Q,N){var Y,I,D,E,t,v;
return g.n(function(p){switch(p.Z){case 1:if(Y=Q){p.CJ(2);break}return g.r(p,wie([f]),3);case 3:I=p.K,D=I[0],Y=WB9(D);case 2:return g.r(p,gSB(M,Y,f,N,A),4);case 4:E=p.K;t=E.musicTrackEntity;v=E.uu;var h=Ur(t.thumbnailDetails),S=[];v&&(S=Ur(v.thumbnailDetails));return g.r(p,m7(h.concat(S)),0)}})},gSB=function(M,f,A,Q,N){var Y;
return g.n(function(I){return I.Z==1?(N||(N=Date.now().toString()),Y={id:g.fZ(A,"musicTrackDownloadMetadataEntity"),playbackData:g.fZ(A,"playbackData"),addedTimestampMillis:N,videoDownloadContextEntity:g.fZ(A,"videoDownloadContextEntity")},Q&&(f.albumRelease=Q.id),g.r(I,Gx(M.K,{mode:"readwrite",gq:!0},function(D){var E=[],t=O4(D,Y,"musicTrackDownloadMetadataEntity");E.push(t);t=O4(D,f,"musicTrack");E.push(t);Q&&(D=O4(D,Q,"musicAlbumRelease"),E.push(D));return g.gX.all(E)}),2)):I.Z!=3?g.r(I,LC(A,"musicTrackDownloadMetadataEntity",
M.K,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):I.return({musicTrackEntity:f,
uu:Q})})},MI=function(){Xp.apply(this,arguments);
this.B="musicTrack"},BBm=function(M,f,A){f=f===void 0?43200:f;
A=A===void 0?!0:A;var Q=Q===void 0?!1:Q;var N,Y;return g.n(function(I){switch(I.Z){case 1:if(!M.G.Ag())return I.return([]);N=[];g.HX(I,2);return g.r(I,YkW(f,A,Q),4);case 4:N=I.K;g.Rf(I,3);break;case 2:g.id(I);case 3:return Y=zm7(M,N,A,"musicPlaylist"),I.return(Y)}})},i4w=function(){g.CV.apply(this,arguments);
var M=this;this.events=new g.yK(this);this.QY=this.player.T();this.Ed={xT_:function(){return M.K},
hY:function(){return M.hY()},
Wm:function(f){return M.Wm(f)}}},x49=function(M){var f;
M=g.b((f=M.getWatchNextResponse())==null?void 0:f.currentVideoEndpoint,g.N5);if(M==null?0:M.playlistId)var A=M.playlistId;return A},Z46=function(M,f){var A,Q,N,Y;
return g.n(function(I){if(I.Z==1){A=f.clientPlaybackNonce;Q={cpn:A,offlineSourceVisualElement:g.Rz(f.fJ||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};f.Z&&(Q.videoFmt=Number(f.Z.itag));f.C&&(Q.audioFmt=Number(f.C.itag));if((N=x49(f))&&f.videoId){var D=f.videoId;D=N!=="PPSV"?Promise.resolve(!1):M.K.GE(D);I=g.r(I,D,3)}else I=I.CJ(2);return I}I.Z!=2&&(Y=I.K)&&(Q.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");M.Z=A;g.hO("offlinePlaybackStarted",Q);g.qc(I)})};
g.xX.prototype.xj=g.If(51,function(M){return this.app.xj(M)});
g.oO.prototype.xj=g.If(50,function(M){return g.X0b(this,9,M)});
g.U($N,jm);g.Tz.Object.defineProperties($N.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.K.entityMetadata},
set:function(M){this.K.entityMetadata=M}}});
g.U(mW9,$N);mW9.prototype.Z=function(){return[]};
g.U(sSB,$N);sSB.prototype.Z=function(){return[]};
g.U(cpm,$N);cpm.prototype.Z=function(){return[]};
g.U(R9m,$N);R9m.prototype.Z=function(){return[]};
g.U(gQB,$N);gQB.prototype.Z=function(){var M=[];this.K.alternateChannel&&M.push(this.K.alternateChannel);this.K.alternateChannelList&&M.push.apply(M,g.c(this.K.alternateChannelList));this.K.oneofChannelEntity&&M.push(this.K.oneofChannelEntity);return[].concat(g.c(new Set(M)))};
g.U(BEC,$N);BEC.prototype.Z=function(){var M=[];this.K.entryCollection&&M.push(this.K.entryCollection);return[].concat(g.c(new Set(M)))};
g.U(iSB,jm);iSB.prototype.Z=function(){var M=[];this.K.video&&M.push(this.K.video);return[].concat(g.c(new Set(M)))};
g.U(xWm,$N);xWm.prototype.Z=function(){var M=[];this.K.parentPlaylist&&M.push(this.K.parentPlaylist);if(this.K.entries)for(var f=g.V(this.K.entries),A=f.next();!A.done;A=f.next())M.push.apply(M,g.c((new iSB(A.value)).Z()));return[].concat(g.c(new Set(M)))};
g.U(ZSC,$N);ZSC.prototype.Z=function(){var M=[];this.K.descriptionEntity&&M.push(this.K.descriptionEntity);this.K.creators&&M.push.apply(M,g.c(this.K.creators));this.K.theBiggestFan&&M.push(this.K.theBiggestFan);return[].concat(g.c(new Set(M)))};
g.U(rpm,$N);rpm.prototype.Z=function(){return[]};
g.U(uJ7,$N);uJ7.prototype.Z=function(){return[]};
g.U(z90,$N);z90.prototype.Z=function(){return[]};
g.U(PZ0,$N);PZ0.prototype.Z=function(){return[]};
g.U(nQB,$N);nQB.prototype.Z=function(){return[]};
g.U(jSK,$N);jSK.prototype.Z=function(){return[]};
g.U($Wv,$N);$Wv.prototype.Z=function(){return[]};
g.U(Fuc,$N);Fuc.prototype.Z=function(){return[]};
g.U(ypC,$N);ypC.prototype.Z=function(){return[]};
g.U(dWc,$N);dWc.prototype.Z=function(){var M=[];this.K.downloadsList&&M.push(this.K.downloadsList);this.K.smartDownloadsList&&M.push(this.K.smartDownloadsList);this.K.recommendedDownloadsList&&M.push(this.K.recommendedDownloadsList);this.K.refresh&&M.push(this.K.refresh);return[].concat(g.c(new Set(M)))};
g.U(e9m,jm);e9m.prototype.Z=function(){var M=[];this.K.video&&M.push(this.K.video);this.K.playlist&&M.push(this.K.playlist);this.K.videoItem&&M.push(this.K.videoItem);this.K.playlistItem&&M.push(this.K.playlistItem);return[].concat(g.c(new Set(M)))};
g.U(bSW,$N);bSW.prototype.Z=function(){var M=[];this.K.refresh&&M.push(this.K.refresh);if(this.K.downloads)for(var f=g.V(this.K.downloads),A=f.next();!A.done;A=f.next())M.push.apply(M,g.c((new e9m(A.value)).Z()));return[].concat(g.c(new Set(M)))};
g.U(kH7,$N);kH7.prototype.Z=function(){var M=[];this.K.localImageEntities&&M.push.apply(M,g.c(this.K.localImageEntities));return[].concat(g.c(new Set(M)))};
g.U(WuK,$N);WuK.prototype.Z=function(){var M=[];this.K.playbackData&&M.push(this.K.playbackData);this.K.localImageEntities&&M.push.apply(M,g.c(this.K.localImageEntities));this.K.videoDownloadContextEntity&&M.push(this.K.videoDownloadContextEntity);return[].concat(g.c(new Set(M)))};
g.U(OSB,$N);OSB.prototype.Z=function(){return[]};
g.U(Xg0,$N);Xg0.prototype.Z=function(){var M=[];this.K.fakeChildren&&M.push.apply(M,g.c(this.K.fakeChildren));return[].concat(g.c(new Set(M)))};
g.U(Jpw,$N);Jpw.prototype.Z=function(){var M=[];this.K.video&&M.push(this.K.video);this.K.playbackData&&M.push(this.K.playbackData);this.K.offlineVideoPolicy&&M.push(this.K.offlineVideoPolicy);return[].concat(g.c(new Set(M)))};
g.U(Ku9,$N);Ku9.prototype.Z=function(){return[]};
g.U(GHm,$N);GHm.prototype.Z=function(){var M=[];this.K.channelOwner&&M.push(this.K.channelOwner);this.K.videos&&M.push.apply(M,g.c(this.K.videos));this.K.collaboratorChannels&&M.push.apply(M,g.c(this.K.collaboratorChannels));this.K.downloadState&&M.push(this.K.downloadState);this.K.refresh&&M.push(this.K.refresh);return[].concat(g.c(new Set(M)))};
g.U(wgc,$N);wgc.prototype.Z=function(){var M=[];this.K.video&&M.push(this.K.video);this.K.channelContributor&&M.push(this.K.channelContributor);return[].concat(g.c(new Set(M)))};
g.U(lke,jm);lke.prototype.Z=function(){var M=[];this.K.localImageEntities&&M.push.apply(M,g.c(this.K.localImageEntities));this.K.videoDownloadContextEntity&&M.push(this.K.videoDownloadContextEntity);return[].concat(g.c(new Set(M)))};
g.U(MRm,jm);MRm.prototype.Z=function(){var M=[];this.K.recommendedVideoMetadata&&M.push.apply(M,g.c((new lke(this.K.recommendedVideoMetadata)).Z()));return[].concat(g.c(new Set(M)))};
g.U(fXe,jm);fXe.prototype.Z=function(){var M=[];this.K.playbackPosition&&M.push(this.K.playbackPosition);return[].concat(g.c(new Set(M)))};
g.U(Ajc,$N);Ajc.prototype.Z=function(){var M=[];this.K.owner&&M.push(this.K.owner);this.K.downloadState&&M.push(this.K.downloadState);this.K.userState&&M.push.apply(M,g.c((new fXe(this.K.userState)).Z()));this.K.additionalMetadata&&M.push.apply(M,g.c((new MRm(this.K.additionalMetadata)).Z()));return[].concat(g.c(new Set(M)))};
g.U(Q57,$N);Q57.prototype.Z=function(){var M=[];this.K.userChannelDetails&&M.push(this.K.userChannelDetails);return[].concat(g.c(new Set(M)))};
g.U(NiW,$N);NiW.prototype.Z=function(){var M=[];this.K.channelOwner&&M.push(this.K.channelOwner);this.K.playbackPosition&&M.push(this.K.playbackPosition);this.K.localImageEntities&&M.push.apply(M,g.c(this.K.localImageEntities));this.K.downloadStatus&&M.push(this.K.downloadStatus);return[].concat(g.c(new Set(M)))};
g.U(YSC,$N);YSC.prototype.Z=function(){return[]};
g.U(IXv,$N);IXv.prototype.Z=function(){return[]};
g.U(Tie,$N);Tie.prototype.Z=function(){return[]};
g.U(D2K,$N);D2K.prototype.Z=function(){return[]};
g.U(EEK,$N);EEK.prototype.Z=function(){return[]};
g.U(tRC,$N);tRC.prototype.Z=function(){return[]};
g.U(vE0,$N);vE0.prototype.Z=function(){return[]};
g.U(pRm,$N);pRm.prototype.Z=function(){return[]};
g.U(hlB,$N);hlB.prototype.Z=function(){return[]};
g.U(SS0,$N);SS0.prototype.Z=function(){return[]};
g.U(LbB,$N);LbB.prototype.Z=function(){return[]};
g.U(oEB,$N);oEB.prototype.Z=function(){var M=[];this.K.trackDownloadMetadatas&&M.push.apply(M,g.c(this.K.trackDownloadMetadatas));return[].concat(g.c(new Set(M)))};
g.U(CEc,$N);
CEc.prototype.Z=function(){var M=[];this.K.downloadedTracks&&M.push.apply(M,g.c(this.K.downloadedTracks));this.K.smartDownloadedTracks&&M.push.apply(M,g.c(this.K.smartDownloadedTracks));this.K.downloadedEpisodes&&M.push.apply(M,g.c(this.K.downloadedEpisodes));this.K.downloadedAlbumReleases&&M.push.apply(M,g.c(this.K.downloadedAlbumReleases));this.K.smartDownloadedAlbumReleases&&M.push.apply(M,g.c(this.K.smartDownloadedAlbumReleases));this.K.downloadedPlaylists&&M.push.apply(M,g.c(this.K.downloadedPlaylists));this.K.smartDownloadedPlaylists&&
M.push.apply(M,g.c(this.K.smartDownloadedPlaylists));this.K.metadataOnlyTracks&&M.push.apply(M,g.c(this.K.metadataOnlyTracks));return[].concat(g.c(new Set(M)))};
g.U(U2m,$N);U2m.prototype.Z=function(){var M=[];this.K.trackDownloadMetadatas&&M.push.apply(M,g.c(this.K.trackDownloadMetadatas));return[].concat(g.c(new Set(M)))};
g.U(VR9,$N);VR9.prototype.Z=function(){var M=[];this.K.playbackData&&M.push(this.K.playbackData);this.K.localImageEntities&&M.push.apply(M,g.c(this.K.localImageEntities));this.K.videoDownloadContextEntity&&M.push(this.K.videoDownloadContextEntity);return[].concat(g.c(new Set(M)))};
g.U(aXR,$N);aXR.prototype.Z=function(){var M=[];this.K.musicLibraryStatusEntity&&M.push(this.K.musicLibraryStatusEntity);this.K.primaryArtists&&M.push.apply(M,g.c(this.K.primaryArtists));this.K.details&&M.push(this.K.details);this.K.userDetails&&M.push(this.K.userDetails);this.K.tracks&&M.push.apply(M,g.c(this.K.tracks));this.K.share&&M.push(this.K.share);this.K.downloadMetadata&&M.push(this.K.downloadMetadata);this.K.refresh&&M.push(this.K.refresh);return[].concat(g.c(new Set(M)))};
g.U(qSB,$N);qSB.prototype.Z=function(){var M=[];this.K.albumRelease&&M.push(this.K.albumRelease);this.K.tracks&&M.push.apply(M,g.c(this.K.tracks));return[].concat(g.c(new Set(M)))};
g.U(H27,$N);H27.prototype.Z=function(){var M=[];this.K.albumRelease&&M.push(this.K.albumRelease);return[].concat(g.c(new Set(M)))};
g.U(m2m,$N);m2m.prototype.Z=function(){var M=[];this.K.details&&M.push(this.K.details);this.K.userDetails&&M.push(this.K.userDetails);return[].concat(g.c(new Set(M)))};
g.U(s5w,$N);s5w.prototype.Z=function(){var M=[];this.K.parentArtist&&M.push(this.K.parentArtist);return[].concat(g.c(new Set(M)))};
g.U(cj6,$N);cj6.prototype.Z=function(){var M=[];this.K.parentArtist&&M.push(this.K.parentArtist);return[].concat(g.c(new Set(M)))};
g.U(RlB,$N);RlB.prototype.Z=function(){return[]};
g.U(gEB,$N);gEB.prototype.Z=function(){return[]};
g.U(Bi7,jm);Bi7.prototype.Z=function(){var M=[];this.K.creatorEntity&&M.push(this.K.creatorEntity);return[].concat(g.c(new Set(M)))};
g.U(i20,$N);
i20.prototype.Z=function(){var M=[];this.K.tracks&&M.push.apply(M,g.c(this.K.tracks));this.K.refresh&&M.push(this.K.refresh);this.K.musicLibraryStatusEntity&&M.push(this.K.musicLibraryStatusEntity);this.K.details&&M.push(this.K.details);this.K.downloadMetadata&&M.push(this.K.downloadMetadata);this.K.sideloadMetadata&&M.push(this.K.sideloadMetadata);this.K.userDetails&&M.push(this.K.userDetails);this.K.entryCollection&&M.push(this.K.entryCollection);this.K.share&&M.push(this.K.share);this.K.podcastShowAdditionalMetadata&&M.push.apply(M,
g.c((new Bi7(this.K.podcastShowAdditionalMetadata)).Z()));return[].concat(g.c(new Set(M)))};
g.U(x2B,$N);x2B.prototype.Z=function(){return[]};
g.U(Z2B,$N);
Z2B.prototype.Z=function(){var M=[];this.K.musicLibraryStatusEntity&&M.push(this.K.musicLibraryStatusEntity);this.K.artists&&M.push.apply(M,g.c(this.K.artists));this.K.audioModeVersion&&M.push(this.K.audioModeVersion);this.K.videoModeVersion&&M.push(this.K.videoModeVersion);this.K.userDetails&&M.push(this.K.userDetails);this.K.details&&M.push(this.K.details);this.K.albumRelease&&M.push(this.K.albumRelease);this.K.share&&M.push(this.K.share);this.K.libraryEdit&&M.push(this.K.libraryEdit);this.K.downloadMetadata&&
M.push(this.K.downloadMetadata);this.K.playbackPosition&&M.push(this.K.playbackPosition);this.K.lyrics&&M.push(this.K.lyrics);return[].concat(g.c(new Set(M)))};
g.U(rj9,$N);rj9.prototype.Z=function(){var M=[];this.K.parentTrack&&M.push(this.K.parentTrack);return[].concat(g.c(new Set(M)))};
g.U(uCW,$N);uCW.prototype.Z=function(){var M=[];this.K.parentTrack&&M.push(this.K.parentTrack);return[].concat(g.c(new Set(M)))};
g.U(zl7,$N);zl7.prototype.Z=function(){return[]};
g.U(PEm,$N);PEm.prototype.Z=function(){return[]};
g.U(nEB,$N);nEB.prototype.Z=function(){return[]};
g.U(j5m,$N);j5m.prototype.Z=function(){return[]};
g.U($2B,$N);$2B.prototype.Z=function(){var M=[];this.K.transfer&&M.push(this.K.transfer);this.K.adsPlaybackData&&M.push.apply(M,g.c(this.K.adsPlaybackData));this.K.drmLicense&&M.push(this.K.drmLicense);this.K.offlineVideoPolicy&&M.push(this.K.offlineVideoPolicy);this.K.videoDownloadContextEntity&&M.push(this.K.videoDownloadContextEntity);return[].concat(g.c(new Set(M)))};
g.U(FbC,$N);FbC.prototype.Z=function(){return[]};
g.U(yj9,$N);yj9.prototype.Z=function(){var M=[];this.K.offlineVideoStreams&&M.push.apply(M,g.c(this.K.offlineVideoStreams));this.K.captionTrack&&M.push.apply(M,g.c(this.K.captionTrack));return[].concat(g.c(new Set(M)))};
g.U(d20,$N);d20.prototype.Z=function(){return[]};
g.U(el9,$N);el9.prototype.Z=function(){return[]};
g.U(b2B,$N);b2B.prototype.Z=function(){return[]};
g.U(kUB,$N);kUB.prototype.Z=function(){return[]};
g.U(Wbc,$N);Wbc.prototype.Z=function(){return[]};
g.U(O2m,$N);O2m.prototype.Z=function(){return[]};
g.U(XRW,$N);XRW.prototype.Z=function(){return[]};
g.U(Jje,$N);Jje.prototype.Z=function(){return[]};
g.U(KbB,$N);KbB.prototype.Z=function(){return[]};
g.U(GUv,$N);GUv.prototype.Z=function(){return[]};
g.U(wRc,$N);wRc.prototype.Z=function(){return[]};
g.U(lX7,$N);lX7.prototype.Z=function(){return[]};
g.U(M_B,$N);M_B.prototype.Z=function(){return[]};
g.U(f29,$N);f29.prototype.Z=function(){return[]};
g.U(A_7,$N);A_7.prototype.Z=function(){return[]};
g.U(QQB,$N);QQB.prototype.Z=function(){return[]};
g.U(N1C,$N);N1C.prototype.Z=function(){return[]};
g.U(Ync,$N);Ync.prototype.Z=function(){return[]};
g.U(I2K,$N);I2K.prototype.Z=function(){return[]};
g.U(T1K,$N);T1K.prototype.Z=function(){return[]};
var IIC=["browse","music/browse","unplugged/browse"],v6W=["offline/playlist_sync_check"],GYv=["offline"],T80=["offline/offline_video_playback_position_sync"],E6B=["offline/get_playback_data_entity"],F4;yg.getInstance=function(){return g.n(function(M){return M.return(new Promise(function(f){g.fr().then(function(A){A?(yg.instance||(yg.instance=new yg(A)),f(yg.instance)):f(void 0)})}))})};
yg.prototype.get=function(M){var f=this,A,Q,N;return g.n(function(Y){if(Y.Z==1)return g.r(Y,vMW(f.token),2);if(Y.Z!=3)return A=Y.K,g.r(Y,A.get("prefs",M),3);Q=Y.K;if(!Q)return Y.return();N=(0,g.W)();return Q.expirationTimestampMs<=N?Y.return():Y.return(Q.value)})};
yg.prototype.set=function(M,f,A){A=A===void 0?31536E3:A;var Q=this,N,Y,I;return g.n(function(D){if(D.Z==1)return N=(0,g.W)(),Y={key:M,value:f,expirationTimestampMs:N+A*1E3},g.r(D,vMW(Q.token),2);I=D.K;return g.r(D,g.nH(I,"prefs",Y),0)})};
yg.prototype.remove=function(M){var f=this,A;return g.n(function(Q){if(Q.Z==1)return g.r(Q,vMW(f.token),2);A=Q.K;return g.r(Q,A.delete("prefs",M),0)})};
g.U(dd,g.GX);g.U(em,oM0);em.prototype.j=function(M,f){f=U7W(f);M=(new TextEncoder).encode(JSON.stringify(M));return this.K.encrypt(M,f)};
em.prototype.Z=function(M,f){if(!(M instanceof Uint8Array))throw pWc(1);var A=new TextDecoder;f=U7W(f);M=this.K.decrypt(M,f);return JSON.parse(A.decode(M))};
var V_e={accountLinkStatusEntity:z90,booleanEntity:cpm,buttonEntity:M_B,captionTrack:zl7,channelHandle:mW9,commerceAcquisitionClientPayloadEntity:A_7,commerceCartListEntity:QQB,contextNoteFeedEntityPayload:sSB,continuationTokenEntity:Ku9,downloadQualityPickerEntity:$Wv,downloadsPageRefreshTokenEntity:ypC,downloadsPageViewConfigurationEntity:YSC,downloadStatusEntity:Fuc,dismissState:XRW,sfvAudioItemCurrentlyPlayingEntity:kUB,emojiFountainDataEntity:wRc,emojiCustomizationSetEntity:GUv,fakeChannel:gQB,
fakePlaylist:BEC,fakePlaylistEntryCollection:xWm,fakeVideo:ZSC,fakeVideoDescription:rpm,featuredProductsEntity:hlB,flowStateEntity:uJ7,iconBadgeEntity:N1C,interstitialInteractionStateEntity:nQB,likeButtonAnimationEntity:IXv,liveChatPollStateEntity:jSK,liveViewerLeaderboardChatEntryPointStateEntity:el9,liveViewerLeaderboardPointsEntity:b2B,liveReactionsDataEntity:lX7,logoEntity:PZ0,macroMarkerEntity:Tie,mainDownloadsLibraryEntity:dWc,mainDownloadsListEntity:bSW,mainPlaylistDownloadStateEntity:kH7,
mainPlaylistEntity:GHm,mainPlaylistVideoEntity:wgc,mainVideoDownloadStateEntity:WuK,mainVideoEntity:Ajc,markersEngagementPanelSyncEntity:D2K,markersVisibilityOverrideEntity:EEK,musicAlbumReleaseDetail:qSB,musicAlbumReleaseDownloadMetadataEntity:oEB,musicAlbumRelease:aXR,musicAlbumReleaseUserDetail:H27,musicArtistDetail:s5w,musicArtist:m2m,musicArtistUserDetail:cj6,musicDownloadsLibraryEntity:CEc,musicLibraryEdit:RlB,musicLibraryStatusEntity:gEB,musicPlaylist:i20,musicPlaylistDownloadMetadataEntity:U2m,
musicShare:x2B,musicTrackDetail:rj9,musicTrackDownloadMetadataEntity:VR9,musicTrack:Z2B,musicTrackUserDetail:uCW,offlineOrchestrationActionWrapperEntity:PEm,offlineVideoPolicy:nEB,offlineVideoStreams:j5m,offlineabilityEntity:OSB,orchestrationWebSamplingEntity:Xg0,pageHeaderEntity:Jje,pdpStateEntity:Ync,pinnedProductEntity:SS0,playbackData:$2B,playerStateEntity:tRC,quantityIncrementerEntity:I2K,refresh:FbC,saveToPlaylistListEntity:Wbc,settingEntity:O2m,stringEntity:R9m,suggestedFeedbackChipStateEntity:vE0,
transfer:yj9,trendingOfferEntity:LbB,videoDownloadContextEntity:d20,videoOverviewAsyncDataEntity:T1K,videoPlaybackPositionEntity:f29,votingEntity:KbB,ytMainChannelEntity:Q57,youchatPendingResponseEntity:pRm,ytMainDownloadedVideoEntity:Jpw,ytMainVideoEntity:NiW};g.U(J1,oM0);J1.prototype.j=function(M){return M};
J1.prototype.Z=function(M){if(M instanceof Uint8Array)throw pWc(0);return M};
g.U(K9,g.y);K9.prototype.observe=function(M){var f=this;this.observers.push(M);return function(){var A=f.observers.indexOf(M);A>=0&&f.observers.splice(A,1)}};
K9.prototype.Z=function(M){udK(this,M.data)};
K9.prototype.u8=function(){this.channel.close()};
var $7m,nWe=new g.iG("elementsCommand");var c0=new g.iG("entityBatchUpdate");var sc9=new g.iG("downloadStatusEntity");var yZ0=new g.iG("mainPlaylistEntityActionMetadata");var Gh=new g.iG("mainVideoEntityActionMetadata");var KBc=new g.iG("musicPlaylistEntityActionMetadata");var qGw=new g.iG("musicTrackEntityActionMetadata");var A39=new g.iG("localImageEntityActionMetadata");var nC=new g.iG("playbackDataActionMetadata");var jm0=new g.iG("transferEntityActionMetadata");var HlR=new g.iG("videoPlaybackPositionEntityActionMetadata");var MM7;new g.LB;new g.LB;YJC.prototype.request=function(M,f,A){f=f===void 0?{}:f;return this.locks.request(M,f,function(Q){return A(Q)})};var N$=g.Kb.caches,QD,tM0;Ai.prototype.open=function(M){return N$.open(Dlw(M))};
Ai.prototype.has=function(M){return N$.has(Dlw(M))};
Ai.prototype.delete=function(M){return N$.delete(Dlw(M))};
Ai.prototype.match=function(M,f){var A=this,Q,N,Y,I,D,E;return g.n(function(t){switch(t.Z){case 1:return g.r(t,A.keys(),2);case 2:Q=t.K,N=g.V(Q),Y=N.next();case 3:if(Y.done){t.CJ(5);break}I=Y.value;return g.r(t,A.open(I),6);case 6:return D=t.K,g.r(t,D.match(M,f),7);case 7:if(E=t.K)return t.return(E);Y=N.next();t.CJ(3);break;case 5:return t.return()}})};
g.U(Ta6,Ai);Ta6.prototype.keys=function(){var M,f,A,Q,N,Y,I,D,E;return g.n(function(t){if(t.Z==1)return M=[],f=g.w$("CacheStorage keys"),g.r(t,N$.keys(),2);A=t.K;Q=g.V(A);for(N=Q.next();!N.done;N=Q.next()){Y=N.value;var v=Y.indexOf(":");I=v===-1?{j3:Y}:{j3:Y.substring(0,v),datasyncId:Y.substring(v+1)};D=I.j3;E=I.datasyncId;E===f&&M.push(D)}return t.return(M)})};g.U(Is,g.y);Is.prototype.j=function(M){this.api.T0("onOfflineOperationFailure",M.data)};
Is.prototype.C=function(M){this.api.publish("offlinetransferpause",M.data)};
Is.prototype.u8=function(){var M;(M=this.K)==null||M.close();var f;(f=this.Z)==null||f.close()};h2W.prototype.Zy=function(){this.K&&DW(this)};
h2W.prototype.Jj=function(){this.Z&&this.Z.resolve();this.j=this.K=!1;this.B()};var Mbw=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var uj6="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var kY9="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.U(hhC,uw);hhC.prototype.Z=function(M){return pC(M)?o6B(this,M):hi(M)?VFW(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};g.U(aIK,uw);aIK.prototype.Z=function(M){return hi(M)?qk7(this,M):mlm(M)?msK(this,M):S6(M)?sm6(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};g.C=cCW.prototype;g.C.uC$=function(M){var f=this,A,Q,N,Y;return g.n(function(I){if(!g.J(M.state,128))return I.CJ(0);A=M.state.MQ;var D=(Q=A)==null?void 0:Q.errorCode,E=(N=A)==null?void 0:N.vG;Y=D==="net.connect"&&E===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(D==null?0:D.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.r(I,f.Wp(f.player.getVideoData().videoId,Y),0)})};
g.C.Wp=function(M,f){var A=this;return g.n(function(Q){if(Q.Z==1){if(A.Z)return Q.return();A.Z=!0;return f==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Fp(A,M,!1,!0),Q.CJ(0)):g.r(Q,$h(A,M),3)}g.jH(M,4);return g.r(Q,A.K.Wp(f),0)})};
g.C.L7=function(M){M.status===2?(M.status!==this.j&&(qDW(this.K),g.jH(M.videoId,2)),M.GA&&Rm9(this.K,M.videoId,M.GA)):M.status===4?($h(this,M.videoId),this.Wp(M.videoId,M.V1?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):M.status===1&&cZW(this.K);this.j=M.status;this.api.T0("localmediachange",{videoId:M.videoId,status:M.status})};
g.C.Ac=function(){var M=this,f;return g.n(function(A){if(A.Z==1){if(M.Z)return A.return();M.Z=!0;f=M.player.getVideoData().videoId;return g.r(A,$h(M,f),2)}return g.r(A,M.K.Ac(),0)})};
g.C.Dq=function(M){switch(M){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.C.V=function(M){return this.api.T().V(M)};g.U(rCW,uw);rCW.prototype.Z=function(M){return pC(M)?zhB(this,M):hi(M)?Pa6(this,M):mlm(M)?n60(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};ehm.prototype.K=function(M,f){var A=M.action.actionMetadata.priority-f.action.actionMetadata.priority;A===0&&(M.K<f.K?A=-1:M.K>f.K&&(A=1));return A};g.U(yD,g.y);yD.prototype.u8=function(){this.B&&this.B();g.y.prototype.u8.call(this)};
yD.prototype.createAction=function(M,f){var A=g.M0(M.entityKey).entityType,Q=g.RP(16);return new VD(A,Q,M,f.actionId,f.rootActionId)};
yD.prototype.KJ=function(M){var f=this,A,Q,N,Y,I,D,E,t,v;return g.n(function(p){if(p.Z==1){if(f.ek())return p.return();Q=(A=M.offlineOrchestrationActionWrapperEntity)!=null?A:new Set;N=[];Y=g.V(Q);for(I=Y.next();!I.done;I=Y.next())D=I.value,E=g.M0(D),t=E.entityId,Wev(f.K,t)||N.push(D);return g.r(p,QAw(f,N),2)}v=p.K;return g.r(p,AZK(f,v),0)})};
yD.prototype.retry=function(){var M=this;return g.n(function(f){return g.r(f,NPe(M),0)})};Igv.prototype.T7=function(M,f){f=f===void 0?!0:f;var A=this,Q,N,Y,I,D,E,t,v;return g.n(function(p){switch(p.Z){case 1:if(!A.K)return p.return();Q=[];N=g.NP(A.K.Z,f);Y=[];for(I={xH:0};I.xH<N.length;I={xH:I.xH},I.xH++)D=N[I.xH],E=A.K.v8(D,"json3"),t=g.ul(E,{withCredentials:!0,format:"RAW"},3,500).then(function(h){return function(S){S={metadata:g.H5(N[h.xH]),trackData:S.xhr.responseText};Y.push(S)}}(I)).BU(function(h){Yh("Caption fetch error",h)}),Q.push(t);
return g.r(p,HSR(Q),2);case 2:return g.HX(p,3),g.r(p,OzB(M,Y),5);case 5:g.Rf(p,0);break;case 3:v=g.id(p),Yh("Caption DB transaction error",v),g.qc(p)}})};g.U(dl,g.y);dl.prototype.u8=function(){this.Z&&this.Z();g.y.prototype.u8.call(this)};
dl.prototype.j=function(M){var f=this,A,Q,N,Y,I,D,E,t;return g.n(function(v){Q=(A=M.transfer)!=null?A:new Set;N=[];Y=g.V(Q);for(I=Y.next();!I.done;I=Y.next())D=I.value,E=g.M0(D),t=E.entityId,N.push(t);return N.length===0?v.return():g.r(v,E2w(f,N),0)})};g.U(SDW,g.y);g.C=SDW.prototype;g.C.u8=function(){this.jk&&this.jk();this.P7.dispose();this.C.dispose();this.fJ&&g.QX(this.G.AC,this.fJ);this.g_&&g.QX(this.G.AC,this.g_);g.y.prototype.u8.call(this)};
g.C.wu8=function(M){var f=this,A,Q,N;return g.n(function(Y){switch(Y.Z){case 1:A=g.fZ(M,"transfer");if(f.K&&A===f.K.key){Fp(f.W,f.N,!0);f.C.stop();Y.CJ(0);break}return g.r(Y,Gx(f.Z,{mode:"readwrite",gq:!0},function(I){return bk(I,A,"transfer").then(function(D){if(D&&D.transferState!=="TRANSFER_STATE_COMPLETE"&&D.transferState!=="TRANSFER_STATE_FAILED")return D.transferState="TRANSFER_STATE_PAUSED_BY_USER",O4(I,D,"transfer").then(function(){return D})})}),3);
case 3:Q=Y.K;if(!Q){Y.CJ(0);break}if(!M||!f.j){Y.CJ(5);break}return g.r(Y,LC(M,f.j,f.Z,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.r(Y,kh(f,M),7);case 7:N=Y.K,qJe({videoId:M,BB:Q,offlineModeType:N}),g.qc(Y)}})};
g.C.vz8=function(){var M=this;if(this.K&&this.N){Fp(this.W,this.N,!1);var f=this.K,A=(f==null?0:f.key)?g.M0(f.key).entityId:"";A&&this.j&&(new Promise(function(Q,N){LC(A,M.j,M.Z,"DOWNLOAD_STATE_PAUSED").catch(function(Y){N(Y)})})).catch(function(Q){Yh("Download state setting error",Q)})}this.C.stop()};
g.C.b6=function(){this.K?CrC(this,this.K):bw(this)};
g.C.Ge=function(M){var f=this;return g.n(function(A){switch(A.Z){case 1:if(!f.K){A.CJ(2);break}if(f.K.transferState==="TRANSFER_STATE_COMPLETE"||f.K.transferState==="TRANSFER_STATE_FAILED"||!M.transfer||!M.transfer.has(f.K.key)){A.CJ(3);break}return g.r(A,lk(f.Z,f.K.key,"transfer"),4);case 4:f.K=A.K;if(f.K){A.CJ(3);break}return g.r(A,UY0(f),3);case 3:if(f.K)return A.return();case 2:return g.r(A,bw(f),0)}})};
g.C.Wp=function(M,f){var A=this,Q,N,Y,I,D;return g.n(function(E){switch(E.Z){case 1:if(!A.K){W0(A,"onTransferFailure: "+M);E.CJ(2);break}Q=A.K;Y=((N=Q)==null?0:N.key)?g.M0(Q.key).entityId:"";a:switch(M){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var t=!1;break a;default:t=!0}return t&&g29(A)?g.r(E,Or(A,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.r(E,
BPW(A,M),5);case 5:if(!Y||!A.j){E.CJ(2);break}return g.r(E,LC(Y,A.j,A.Z,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.r(E,kh(A,Y),9);case 9:I=E.K;ti({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:Y,BB:Q,offlineModeType:I});if(!Y||!A.j){E.CJ(2);break}return g.r(E,LC(Y,A.j,A.Z,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:e6(A),D=bw(A,!0),f&&f(D),g.qc(E)}})};
g.C.Ac=function(M){var f=this,A,Q,N,Y,I,D,E,t,v,p,h,S;return g.n(function(L){switch(L.Z){case 1:if(!f.K){W0(f,"onMaybeTransferStreamsExpired");L.CJ(2);break}return g29(f)?g.r(L,Or(f,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.r(L,BPW(f,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!f.j){L.CJ(2);break}A=f.K;N=((Q=A)==null?0:Q.key)?g.M0(A.key).entityId:"";if(!N){L.CJ(2);break}return g.r(L,LC(N,f.j,f.Z,"DOWNLOAD_STATE_FAILED"),2);case 9:return f.K||W0(f,"onMaybeTransferStreamsExpiredRetryAttempting"),
Y=f.K,D=((I=Y)==null?0:I.key)?g.M0(Y.key).entityId:"",g.r(L,kh(f,D),10);case 10:return E=L.K,ti({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:D,BB:Y,offlineModeType:E}),t=gWm(),g.bH(t,nC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),v=g.fZ(D,"playbackData"),p={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:v,actionMetadata:t},h=q$(new VD("playbackData",D,p)),g.r(L,wd(f.Z,h,"offlineOrchestrationActionWrapperEntity"),2);case 2:e6(f),S=bw(f,!0),
M&&M(S),g.qc(L)}})};
var r3K={},i50=(r3K.TRANSFER_STATE_TRANSFERRING=1,r3K.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,r3K);g.C=Xp.prototype;g.C.uH=function(){return this.N.promise};
g.C.pw=function(){if(this.Z&&this.W)return this.N.promise;rZ0(this).then(this.N.resolve).catch(this.N.reject);return this.N.promise};
g.C.VN=function(M){var f={};return f.playbackData=new hhC(M,this.QY,this.K),f.transfer=new rCW(M,this.QY),f.videoPlaybackPositionEntity=new aIK(M,this.QY),f};
g.C.RJ=function(){var M=this;return g.n(function(f){return M.Z?g.r(f,Ls0(M.Z),0):f.CJ(0)})};
g.C.Uy=function(){var M=this,f,A;return g.n(function(Q){if(Q.Z==1)return M.Z||M.W?g.r(Q,M.uH(),2):Q.return();M.X!==void 0&&(g.qR(M.X),M.X=void 0);M.C!==void 0&&(g.qR(M.C),M.C=void 0);(f=M.Z)==null||f.dispose();M.Z=void 0;(A=M.W)==null||A.dispose();M.W=void 0;M.api.T0("onOrchestrationLostLeader");M.N=new g.LB;g.qc(Q)})};
g.C.isOrchestrationLeader=function(){return this.j.K};
g.C.GE=function(){return g.n(function(M){return M.return(!1)})};
g.C.Lp=function(M){var f=this.K;f.api.publish("offlinetransferpause",M);var A;(A=f.Z)==null||A.postMessage(M)};
g.C.b6=function(M){var f,A;return g.n(function(Q){if(Q.Z==1)return g.r(Q,fC(),2);f=Q.K;if(!f)return Q.return();A=g.fZ(M,"transfer");return g.r(Q,Gx(f,{mode:"readwrite",gq:!0},function(N){var Y=bk(N,A,"transfer"),I=bk(N,g.fZ(M,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.gX.all([Y,I]).then(function(D){D=g.V(D);var E=D.next().value;var t=D.next().value;return E&&E.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(E.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",O4(N,E,"transfer").then(function(){ti({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:M,BB:E,offlineModeType:t==null?void 0:t.offlineModeType});return g.gX.resolve(null)})):g.gX.resolve(null)})}),0)})};
g.C.Ha=function(M){M=M===void 0?43200:M;var f=this,A,Q,N,Y,I,D,E,t;return g.n(function(v){if(v.Z==1)return f.G.Ag()?g.r(v,fC(),2):v.return(ur9());if(v.Z!=3){A=v.K;if(!A)return v.return([]);Q=Date.now()/1E3;return g.r(v,M$(A,"offlineVideoPolicy"),3)}N=v.K;Y=[];I=g.V(N);for(D=I.next();!D.done;D=I.next())E=D.value,Number(E.lastUpdatedTimestampSeconds)+M<=Q&&(t=g.M0(E.key).entityId,Y.push(t));return Y.length?v.return(Ji(f,Y,f.B,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):v.return([])})};
g.C.deleteAll=function(){return Ji(this,["!*$_ALL_ENTITIES_!*$"],this.B,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.C.refreshAllStaleEntities=function(M){var f=this;return g.n(function(A){return A.Z==1?g.r(A,f.Ha(M),2):A.return(A.K)})};
g.C.setUpPositionSyncInterval=function(M){var f=this;this.C!==void 0&&(g.qR(this.C),this.C=void 0);var A=M!=null?M:864E5;this.C=g.Vn(function(){f.GC(A)},A)};
g.C.GC=function(M){var f=this,A,Q,N,Y,I,D;return g.n(function(E){switch(E.Z){case 1:return g.HX(E,2),g.r(E,yg.getInstance(),4);case 4:A=E.K;if(!A)throw Error("prefStorage is undefined");return g.r(E,A.get("psi"),5);case 5:Q=E.K;Y=((N=Q)==null?0:N.oM)?Number(Q.oM)/1E3:0;I=Date.now();if(!(Y+M<=I)){E.CJ(6);break}return g.r(E,Ji(f,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Rf(E,0);break;case 2:D=g.id(E),Yh("Offline manager error",D),
g.qc(E)}})};
g.C.Gk=function(){var M=this,f,A,Q,N,Y,I,D;return g.n(function(E){if(E.Z==1)return g.r(E,fC(),2);if(E.Z!=3)return(f=E.K)?g.r(E,M$(f,"transfer"),3):E.return([]);A=E.K;Q=[];N=g.V(A);for(Y=N.next();!Y.done;Y=N.next())I=Y.value,I.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&I.key&&(D=g.M0(I.key).entityId,Q.push(D));return E.return(PrB(M,Q))})};
g.C.O_=function(){return g.n(function(M){return M.return([])})};
g.C.So=function(){return g.n(function(M){g.qc(M)})};
g.C.vn=function(){return g.n(function(M){g.qc(M)})};g.U(n2B,uw);n2B.prototype.Z=function(M){return pC(M)?Fs0(this,M):hi(M)?dYc(this,M):S6(M)?emW(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};
var KC=[10];g.U(Xvc,uw);Xvc.prototype.Z=function(M){return pC(M)?Gic(this,M):hi(M)?wv0(this,M):S6(M)?lgC(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};
var KsC=[10];g.U(fSv,uw);fSv.prototype.Z=function(M){return hi(M)?QbB(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};g.U(NB0,Xp);g.C=NB0.prototype;g.C.VN=function(M){var f=Xp.prototype.VN.call(this,M);f.mainVideoEntity=new Xvc(M,this.QY,this.K);f.mainPlaylistEntity=new n2B(M,this.QY,this.K);f.mainDownloadsListEntity=new fSv(M,this.QY,this.K);return f};
g.C.refreshAllStaleEntities=function(M,f){var A=this,Q,N,Y,I,D,E,t,v,p,h,S;return g.n(function(L){switch(L.Z){case 1:Q=[];if(!A.QY.V("web_player_offline_playlist_auto_refresh")){L.CJ(2);break}return g.r(L,YGe(A,M,f),3);case 3:Q=L.K;case 2:return g.r(L,yg.getInstance(),4);case 4:return N=L.K,g.r(L,(Y=N)==null?void 0:Y.get("sdois"),5);case 5:return I=L.K,g.r(L,(D=N)==null?void 0:D.get("lmqf"),6);case 6:E=L.K;if(!I){L.CJ(7);break}v=Q;p=v.concat;return g.r(L,ISe(A,I,(t=E)!=null?t:"SD",M===0),8);case 8:Q=
p.call(v,L.K);case 7:return h=Q,S=h.concat,g.r(L,Xp.prototype.refreshAllStaleEntities.call(A,M,f),9);case 9:return Q=S.call(h,L.K),L.return(Q)}})};
g.C.GE=function(M){var f,A,Q,N,Y,I,D,E;return g.n(function(t){if(t.Z==1)return g.r(t,fC(),2);if(t.Z!=3)return(f=t.K)?g.r(t,lk(f,g.nR,"mainDownloadsListEntity"),3):t.return(!1);A=t.K;if((Q=A)==null?0:(N=Q.downloads)==null?0:N.length)for(Y=g.fZ(M,"mainVideoEntity"),I=g.V(A.downloads),D=I.next();!D.done;D=I.next())if(E=D.value,E.videoItem===Y)return t.return(!0);return t.return(!1)})};
g.C.O_=function(){var M=this,f,A,Q,N,Y,I,D,E;return g.n(function(t){if(t.Z==1)return g.r(t,fC(),2);if(t.Z!=3)return(f=t.K)?g.r(t,M$(f,"downloadStatusEntity"),3):t.return([]);A=t.K;Q=[];N=g.V(A);for(Y=N.next();!Y.done;Y=N.next())I=Y.value,I.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&I.key&&(D=g.M0(I.key).entityId,Q.push(D));return Q.length?(E={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},t.return(Ji(M,Q,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
E))):t.return([])})};
g.C.vn=function(){var M;return g.n(function(f){return f.Z==1?g.r(f,fC(),2):(M=f.K)?g.r(f,Gx(M,{mode:"readwrite",gq:!0},function(A){return kN(A,"mainVideoEntity").then(function(Q){var N=[];Q=g.V(Q);for(var Y=Q.next();!Y.done;Y=Q.next()){Y=Y.value;var I=void 0;(I=Y.userState)!=null&&I.playbackPosition||(I=g.M0(Y.key).entityId,I={key:g.fZ(I,"videoPlaybackPositionEntity"),videoId:I,lastPlaybackPositionSeconds:"0"},N.push(O4(A,I,"videoPlaybackPositionEntity")),Y.userState={playbackPosition:I.key},N.push(O4(A,
Y,"mainVideoEntity")))}return g.gX.all(N)})}),0):f.return()})};
g.C.So=function(){var M,f,A,Q,N,Y,I,D,E,t,v,p,h,S,L,a,q,m,R,u,z,e,G,X,Qt,Y9,Mc,E0,w,m6,BX,WX,g7,vK,x9,gD,TC,H;return g.n(function(DU){if(DU.Z==1)return g.r(DU,fC(),2);if(DU.Z!=3){M=DU.K;if(!M)return DU.return();f=g.fZ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.r(DU,Gx(M,{mode:"readonly",gq:!0},function(JB){return g.gX.all([bk(JB,f,"mainDownloadsListEntity"),bk(JB,g.nR,"mainDownloadsListEntity"),kN(JB,"mainVideoEntity"),kN(JB,"mainPlaylistEntity")])}),3)}A=DU.K;
Q=g.V(A);N=Q.next().value;Y=Q.next().value;I=Q.next().value;D=Q.next().value;E=N;t=Y;v=I;p=D;h=new Set;if((S=E)==null?0:(L=S.downloads)==null?0:L.length)for(a=g.V(E.downloads),q=a.next();!q.done;q=a.next())m=q.value,R=void 0,(u=(R=m.videoItem)!=null?R:m.playlistItem)&&h.add(u);if((z=t)==null?0:(e=z.downloads)==null?0:e.length)for(G=g.V(t.downloads),X=G.next();!X.done;X=G.next())Qt=X.value,Qt.videoItem&&h.add(Qt.videoItem);Y9=new Set;Mc=[];E0=g.V(p);for(w=E0.next();!w.done;w=E0.next()){m6=w.value;
if(m6.videos)for(BX=g.V(m6.videos),WX=BX.next();!WX.done;WX=BX.next())g7=WX.value,(vK=JSON.parse(g.M0(g7).entityId).videoId)&&Y9.add(vK);m6.key&&!h.has(m6.key)&&Mc.push(m6.key)}x9=g.V(v);for(gD=x9.next();!gD.done;gD=x9.next())TC=gD.value,TC.key&&!h.has(TC.key)&&(H=g.M0(TC.key).entityId,Y9.has(H)||Mc.push(TC.key));return Mc.length?g.r(DU,ywW(M,Mc),0):DU.CJ(0)})};g.U(TB6,uw);TB6.prototype.Z=function(M){return pC(M)?ES9(this,M):hi(M)?toK(this,M):S6(M)?vSm(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};
var wl=[10];g.U(hre,uw);hre.prototype.Z=function(M){return pC(M)?Lmc(this,M):hi(M)?oS0(this,M):S6(M)?CGC(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};
var lw=[10];g.U(aSc,uw);aSc.prototype.Z=function(M){return pC(M)?sb7(this,M):hi(M)?c30(this,M):S6(M)?RrB(this,M):Promise.reject(Error("Unsupported action type: "+M.actionType))};
var m4K=[10];g.U(MI,Xp);MI.prototype.VN=function(M){var f=Xp.prototype.VN.call(this,M);f.musicTrack=new aSc(M,this.K);f.musicPlaylist=new hre(M,this.K);f.musicAlbumRelease=new TB6(M,this.K);return f};
MI.prototype.refreshAllStaleEntities=function(M,f){var A=this,Q,N,Y;return g.n(function(I){if(I.Z==1)return g.r(I,BBm(A,M,f),2);if(I.Z!=3)return N=Q=I.K,Y=N.concat,g.r(I,Xp.prototype.refreshAllStaleEntities.call(A,M,f),3);Q=Y.call(N,I.K);return I.return(Q)})};g.U(i4w,g.CV);g.C=i4w.prototype;g.C.create=function(){var M=this;g.d(this,this.events);if(g.Q5(this.QY))this.K=new NB0(this.QY,this.player);else if(g.dA(this.QY)||g.TG(this.QY)==="WEB_MUSIC_INTEGRATIONS")this.K=new MI(this.QY,this.player);this.events.J(this.player,"onPlaybackStartExternal",function(){M.hY()});
this.events.J(this.player,"videodatachange",function(){M.hY()});
this.QY.V("html5_offline_playback_position_sync")&&this.events.J(this.player,"presentingplayerstatechange",this.Wm)};
g.C.Tv=function(){return!1};
g.C.Fg=function(M,f,A,Q){var N=this;return g.n(function(Y){return N.K?Y.return(Ji(N.K,M,f,A,Q)):Y.return(Promise.reject())})};
g.C.deleteAll=function(){return this.K.deleteAll()};
g.C.Ha=function(M){return this.K.Ha(M)};
g.C.refreshAllStaleEntities=function(M){return this.K.refreshAllStaleEntities(M)};
g.C.setUpPositionSyncInterval=function(M){this.K.setUpPositionSyncInterval(M)};
g.C.Lp=function(M){this.K.Lp(M)};
g.C.b6=function(M){return this.K.b6(M)};
g.C.hY=function(){var M=this,f;return g.n(function(A){f=M.player.getVideoData();return g.Ge(f)?x49(f)&&M.Z!==f.clientPlaybackNonce?g.r(A,Z46(M,f),0):A.CJ(0):A.return()})};
g.C.Wm=function(M){var f=this,A,Q,N,Y,I,D,E;return g.n(function(t){if(t.Z==1)return A=f.player.getVideoData(),Q=A.Yp,g.V2(M,2)||g.V2(M,512)?g.r(t,fC(),2):t.return();if(t.Z!=3){N=t.K;if(!N)return Yh("PES is undefined"),t.return();Y=A.videoId;return g.r(t,lk(N,g.fZ(Y,"mainVideoEntity"),"mainVideoEntity"),3)}I=t.K;if(!I)return t.return();D=Math.floor(Q).toString();E={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:D}};return g.r(t,f.Fg([Y],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
E),0)})};
g.C.isOrchestrationLeader=function(){return this.K.isOrchestrationLeader()};
g.C.updateDownloadState=function(M,f){var A,Q,N,Y;return g.n(function(I){if(I.Z==1)return g.r(I,fC(),2);A=I.K;if(!A)return Yh("PES is undefined"),I.return();Q=g.M0(M);N=Q.entityType;Y=Q.entityId;return g.r(I,LC(Y,N,A,f,!0),0)})};g.oW("offline",i4w);})(_yt_player);
